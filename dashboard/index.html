<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Karting Analytics Platform - Complete Performance Dashboard - TheMaksoo</title>
    <!-- Favicons: SVG primary + small PNG fallback -->
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="alternate icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAB7ElEQVRYR+2Xv0sTURTHf0+gqIhBI0aKJp0K1aCkq0sZ0vQK4kYqJQqIo0q3EhsZq6C7yDgkQpFikxQopJXzXk2Y8Hk8Gd2b3n3n7s7szs3m7u7M7s7v3vO+f8zv/3nM+7zv9cD9SgK5p6nA7a8RBmQ0n6H3HJ6a4WQ5s9G6VtPzKqG4hA6sYy8hQ5s1G6UoOz3z9zF2X4YqE0Z+2Qb6XJ1Yw7k6V+XrG7Wk3m9u0G1n4xyM5r0WJ2Qx5r4yWc9k1Fq3vYQZ46w2x9E2w0Qb2k5n1I1t1G6Gk1n0Gx2gO3fYcZ2M7p9GJ1o8kY5n0Gx2gO3fYcZ2M7p9GJ1o8kY5n0Gx2gO3fYcZ2M7p9GJ1o8kY5n0Gx2gO3fYcZ2M7p9GJ1o8kY5n0Gx2gO3fYcZ2M7p9GJ1o8kY5n0Gx2gO3fYcZ2M7p9GJ1o8kY5n0Gx2gO3fYcZ2M7p9GJ1o8kY5n0Gx2gO3fYcZ2M7p9GJ1o8kY5n0Gx2gO3fYcZ2M7p9GJ1o8kY5n0Gx2gO3fYcZ2M7p9GJ1o8kY5n0Gx2gNs7A4uP8K0j2t2AAAAAElFTkSuQmCC">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <!-- Karting Logo -->
            <div class="loading-logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 64 64">
                    <rect width="100%" height="100%" rx="12" ry="12" fill="#0d1117"/>
                    <text x="32" y="36" font-size="36" text-anchor="middle" dominant-baseline="middle" transform="translate(64,0) scale(-1,1)">üèéÔ∏è</text>
                </svg>
            </div>
            <h2 class="loading-title"> Loading Elite Karting Analytics Platform</h2>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
            <p class="loading-text">Preparing comprehensive performance analytics<span class="loading-dots"></span></p>
        </div>
    </div>

    <div class="app-container">
        <!-- ========== ENHANCED HEADER + SUMMARY TILES ========== -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="racing-logo">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 64 64" class="logo-svg">
                            <rect width="100%" height="100%" rx="12" ry="12" fill="#0d1117"/>
                            <text x="32" y="36" font-size="36" text-anchor="middle" dominant-baseline="middle" transform="translate(64,0) scale(-1,1)">üèéÔ∏è</text>
                        </svg>
                        <div class="logo-text">
                            <h1 class="main-title">ELITE KARTING ANALYTICS</h1>
                            <p class="subtitle">Professional Racing Performance Platform - TheMaksoo</p>
                        </div>
                    </div>
                </div>
                <div class="header-controls">
                    <div id="currentDateTime" class="current-date-time" title="Click to refresh date/time">
                        <div class="date-display">
                            <i class="fas fa-calendar-day"></i>
                            <span id="currentDate">Loading...</span>
                        </div>
                        <div class="time-display">
                            <i class="fas fa-clock"></i>
                            <span id="currentTime">Loading...</span>
                        </div>
                    </div>
                    <div id="filterStatus" class="filter-status hidden">
                        <i class="fas fa-filter"></i>
                        <span id="filterStatusText">Filters Active</span>
                    </div>
                </div>
            </div>
            
            <!-- Global KPI Summary Tiles (4x5 Layout) -->
            <div class="kpi-summary kpi-grid-4x5" data-aos="fade-up">
                <!-- Row 1 - Core Performance Metrics -->
                <div class="kpi-tile" title="Total number of laps completed across all sessions. Filtered by driver/track/date selection.">
                    <div class="kpi-icon"><i class="fas fa-flag-checkered"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="totalLaps">0</span>
                        <span class="kpi-label">Total Laps</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Average lap time across all laps. Lower is faster. Calculated from all lap times in the filtered dataset.">
                    <div class="kpi-icon"><i class="fas fa-stopwatch"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="avgLapOverall">0.00s</span>
                        <span class="kpi-label">Avg Lap Time</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Average of the fastest lap from each session. Shows typical best performance per heat. Better indicator than single fastest lap.">
                    <div class="kpi-icon"><i class="fas fa-bolt"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="fastestLap">0.00s</span>
                        <span class="kpi-label">Avg Best Lap</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Lap time consistency (standard deviation œÉ). Lower = more consistent driving. Measures variation between lap times. Good drivers have low œÉ.">
                    <div class="kpi-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="consistency">0s</span>
                        <span class="kpi-label">Consistency (œÉ)</span>
                    </div>
                </div>
                
                <!-- Row 2 - Sessions & Competition -->
                <div class="kpi-tile" title="Total racing sessions/heats completed. Each session is a separate race event with multiple laps.">
                    <div class="kpi-icon"><i class="fas fa-road"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="totalHeats">0</span>
                        <span class="kpi-label">Sessions</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Number of sessions won (fastest lap in the heat). Ties count as wins for all tied drivers. Shows competitive success rate.">
                    <div class="kpi-icon"><i class="fas fa-trophy"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="sessionsWon">0</span>
                        <span class="kpi-label">Heats Won</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Win rate percentage. Heats won divided by total sessions. Shows competitive performance level.">
                    <div class="kpi-icon"><i class="fas fa-percentage"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="winRate">0%</span>
                        <span class="kpi-label">Win Rate</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Average laps completed per session/heat. Shows typical race length and endurance.">
                    <div class="kpi-icon"><i class="fas fa-layer-group"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="avgLapsPerSession">0</span>
                        <span class="kpi-label">Avg Laps/Session</span>
                    </div>
                </div>
                
                <!-- Row 3 - Distance & Speed Statistics -->
                <div class="kpi-tile" title="Cumulative distance driven across all laps. Calculated by summing each lap's track distance. Shows in km if ‚â•1km, otherwise meters.">
                    <div class="kpi-icon"><i class="fas fa-route"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="totalDistance">0</span>
                        <span class="kpi-label">Total Distance</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Average speed in km/h calculated from lap times and track distances. Formula: (distance / time) √ó 3.6. Indoor: 35-50 km/h, Outdoor: 60-80 km/h.">
                    <div class="kpi-icon"><i class="fas fa-tachometer-alt"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="avgSpeed">0</span>
                        <span class="kpi-label">Avg Speed (km/h)</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Total corners navigated. Each lap adds the track's corner count (9-14 corners per track). More corners = more technical driving.">
                    <div class="kpi-icon"><i class="fas fa-turn-up"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="totalCorners">0</span>
                        <span class="kpi-label">Total Corners</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Number of unique karting tracks visited. Tracks: Circuit Park Berghem (1200m), De Voltage (450m), Lot66 (325m), Goodwill (450m), Experience Factory (350m).">
                    <div class="kpi-icon"><i class="fas fa-map-marked-alt"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="totalTracks">0</span>
                        <span class="kpi-label">Tracks Visited</span>
                    </div>
                </div>
                
                <!-- Row 4 - Financial Metrics -->
                <div class="kpi-tile" title="Total cost spent on karting sessions. Includes all session fees and pricing for the filtered data.">
                    <div class="kpi-icon"><i class="fas fa-euro-sign"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="totalCost">‚Ç¨0</span>
                        <span class="kpi-label">Total Cost</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Cost efficiency per lap. Total cost divided by number of laps. Lower values indicate better value for money per race.">
                    <div class="kpi-icon"><i class="fas fa-coins"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="costPerLap">‚Ç¨0</span>
                        <span class="kpi-label">Cost per Lap</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Cost efficiency per kilometer. Total cost divided by total distance. Helps compare track pricing per distance driven.">
                    <div class="kpi-icon"><i class="fas fa-money-bill-wave"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="costPerKm">‚Ç¨0</span>
                        <span class="kpi-label">Cost per km</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Average cost per session/heat. Total cost divided by number of sessions. Shows typical expense per track visit.">
                    <div class="kpi-icon"><i class="fas fa-receipt"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="costPerSession">‚Ç¨0</span>
                        <span class="kpi-label">Cost per Session</span>
                    </div>
                </div>
                
                <!-- Row 5 - Data & Environmental -->
                <div class="kpi-tile" title="Total data entries/records in the filtered dataset. Each lap is one entry with ~30 data fields (time, speed, position, cost, etc).">
                    <div class="kpi-icon"><i class="fas fa-database"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="totalEntries">0</span>
                        <span class="kpi-label">Data Entries</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Total individual data points captured. Calculated as entries √ó 30 fields. Includes lap times, positions, sectors, costs, track data, weather, etc.">
                    <div class="kpi-icon"><i class="fas fa-chart-pie"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="dataPoints">0</span>
                        <span class="kpi-label">Data Points</span>
                    </div>
                </div>
                <div class="kpi-tile" title="Estimated CO‚ÇÇ emissions from karting. Gas karts: ~150g/km, E-karts: ~50g/km (grid mix). Based on track type and total distance driven.">
                    <div class="kpi-icon"><i class="fas fa-smog"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="co2Emissions">0</span>
                        <span class="kpi-label">CO‚ÇÇ Emissions</span>
                    </div>
                </div>
                <div class="kpi-tile" title="CO‚ÇÇ offset equivalent in trees. 1 tree absorbs ~21kg CO‚ÇÇ/year. Shows how many trees for 1 year would offset your karting emissions.">
                    <div class="kpi-icon"><i class="fas fa-tree"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-value" id="treesOffset">0</span>
                        <span class="kpi-label">Trees Needed</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- ========== ADVANCED FILTER BAR ========== -->
        <section class="filter-bar" data-aos="fade-up" data-aos-delay="100">
            <div class="filter-content">
                <div class="filter-group">
                    <label><i class="fas fa-user"></i> Driver <span class="instant-filter-note">‚Ä¢ Auto-apply</span></label>
                    <select id="driverFilter" class="filter-select">
                        <option value="">All Drivers</option>
                        <!-- driver options populated dynamically -->
                    </select>
                </div>
                <div class="filter-group">
                    <label><i class="fas fa-map-marker-alt"></i>All Tracks <span class="instant-filter-note">‚Ä¢ Auto-apply</span></label>
                    <select id="trackFilter" class="filter-select">
                        <option value="">All Tracks</option>
                        <!-- track options populated dynamically -->
                    </select>
                </div>
                <div class="filter-group">
                    <label><i class="fas fa-calendar"></i> Date Range <span class="instant-filter-note">‚Ä¢ Auto-apply</span></label>
                    <input type="date" id="dateFromFilter" class="filter-input">
                    <input type="date" id="dateToFilter" class="filter-input">
                </div>
                <div class="filter-actions">
                    <button id="clearFilters" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Clear Filters
                    </button>
                </div>
            </div>
        </section>

        <!-- ========== 1. DRIVER PERFORMANCE OVERVIEW ========== -->
        <section class="section driver-performance-section charts-loading" data-aos="fade-up" data-aos-delay="200">
            <div class="section-header" onclick="toggleSection(this)">
                <div>
                    <h2><i class="fas fa-tachometer-alt"></i> Driver Performance Overview</h2>
                    <p>Comprehensive analysis of driver performance across time and tracks</p>
                </div>
                <button class="section-toggle" aria-label="Toggle section">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div class="charts-grid performance-grid section-content">
                <!-- Driver Ranking Over Time -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-line"></i> Driver Ranking Over Time</h3>
                        <div class="chart-controls">
                            <select id="rankingMetricSelect">
                                <option value="position">Average Position</option>
                                <option value="laptime">Average Lap Time</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="driverRankingChart"></canvas>
                </div>

                <!-- Fastest Lap by Driver -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-trophy"></i> Fastest Lap by Driver</h3>
                    </div>
                    <canvas id="fastestLapChart"></canvas>
                </div>

                <!-- Average Lap Time per Driver -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-bar"></i> Average Lap Time per Driver</h3>
                        <div class="chart-controls">
                            <select id="avgLapGroupBy">
                                <option value="overall">Overall</option>
                                <option value="track">By Track</option>
                                <option value="session">By Session</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="avgLapTimeChart"></canvas>
                </div>

                <!-- Consistency Index -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-bullseye"></i> Consistency Index</h3>
                        <p class="chart-subtitle">Lower variance = more consistent</p>
                    </div>
                    <canvas id="consistencyChart"></canvas>
                </div>

                <!-- Improvement Over Sessions -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-trending-up"></i> Improvement Over Sessions</h3>
                        <div class="chart-controls">
                            <select id="improvementDriverSelect">
                                <option value="all">All Drivers</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="improvementChart"></canvas>
                </div>

                <!-- Lap Time Distribution -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-area"></i> Lap Time Distribution</h3>
                        <div class="chart-controls">
                            <select id="distributionDriverSelect">
                                <option value="all">All Drivers</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="lapDistributionChart"></canvas>
                </div>

                <!-- Best Lap Heatmap -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-fire"></i> Best Lap Heatmap</h3>
                        <p class="chart-subtitle">Driver vs Track performance matrix</p>
                    </div>
                    <div id="bestLapHeatmap" class="heatmap-container"></div>
                </div>

                <!-- Start vs End Pace Analysis -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-clock"></i> Start vs End Pace</h3>
                        <p class="chart-subtitle">Fatigue vs focus analysis</p>
                    </div>
                    <canvas id="paceAnalysisChart"></canvas>
                </div>
            </div>
        </section>

        <!-- ========== 2. LAP & SESSION ANALYSIS ========== -->
        <section class="section lap-session-section charts-loading collapsed" data-aos="fade-up" data-aos-delay="300">
            <div class="section-header" onclick="toggleSection(this)">
                <div>
                    <h2><i class="fas fa-flag-checkered"></i> Lap & Session Analysis</h2>
                    <p>Deep dive into performance within individual sessions</p>
                </div>
                <button class="section-toggle" aria-label="Toggle section">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div class="charts-grid session-grid section-content">
                <!-- Lap Time Trend -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-line"></i> Lap Time Trend</h3>
                        <div class="chart-controls">
                            <select id="sessionSelect">
                                <option value="">Select Session</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="lapTimeTrendChart"></canvas>
                </div>

                <!-- Gap Evolution -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-area"></i> Gap Evolution</h3>
                    </div>
                    <canvas id="gapEvolutionChart"></canvas>
                </div>

                <!-- Best Lap Comparison -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-medal"></i> Best Lap Comparison</h3>
                    </div>
                    <canvas id="bestLapComparisonChart"></canvas>
                </div>

                <!-- Consistency Heatmap -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-fire"></i> Session Consistency Heatmap</h3>
                        <p class="chart-subtitle">Green = fast, Red = slow</p>
                    </div>
                    <div id="sessionConsistencyHeatmap" class="heatmap-container"></div>
                </div>

                <!-- Performance Stability -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-bar"></i> Performance Stability</h3>
                        <p class="chart-subtitle">Standard deviation per heat</p>
                    </div>
                    <canvas id="performanceStabilityChart"></canvas>
                </div>

                <!-- Pace Dropoff Graph -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-battery-quarter"></i> Pace Dropoff</h3>
                        <p class="chart-subtitle">Lap time increase throughout session</p>
                    </div>
                    <canvas id="paceDropoffChart"></canvas>
                </div>

                <!-- Session Summary Cards -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-clipboard-list"></i> Session Summary Cards</h3>
                    </div>
                    <div id="sessionSummaryCards" class="session-cards-container"></div>
                </div>
            </div>
        </section>

        <!-- ========== 3. TRACK INSIGHTS ========== -->
        <section class="section track-insights-section charts-loading collapsed" data-aos="fade-up" data-aos-delay="400">
            <div class="section-header" onclick="toggleSection(this)">
                <div>
                    <h2><i class="fas fa-map-marked-alt"></i> Track Insights</h2>
                    <p>Compare performance per track and identify track-specific advantages</p>
                </div>
                <button class="section-toggle" aria-label="Toggle section">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div class="charts-grid track-grid section-content">
                <!-- Track Performance Comparison -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-bar"></i> Track Performance Comparison</h3>
                    </div>
                    <canvas id="trackPerformanceChart"></canvas>
                </div>

                <!-- Best Lap per Track Table -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-trophy"></i> Best Lap per Track</h3>
                    </div>
                    <div id="bestLapPerTrackTable" class="data-table-container"></div>
                </div>

                <!-- Track Difficulty Index -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-cog"></i> Track Difficulty Index</h3>
                        <p class="chart-subtitle">Based on lap time spread</p>
                    </div>
                    <canvas id="trackDifficultyChart"></canvas>
                </div>

                <!-- Weather Impact Chart -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-cloud-sun"></i> Weather Impact</h3>
                    </div>
                    <canvas id="weatherImpactChart"></canvas>
                </div>

                <!-- Indoor vs Outdoor Comparison -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-building"></i> Indoor vs Outdoor</h3>
                    </div>
                    <canvas id="indoorOutdoorChart"></canvas>
                </div>

                <!-- Tyre Type Performance -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-circle-dot"></i> Tyre Performance</h3>
                    </div>
                    <canvas id="tyrePerformanceChart"></canvas>
                </div>
            </div>
        </section>

        <!-- ========== 4. DRIVER VS DRIVER BATTLES ========== -->
        <section class="section driver-battles-section charts-loading collapsed" data-aos="fade-up" data-aos-delay="500">
            <div class="section-header" onclick="toggleSection(this)">
                <div>
                    <h2><i class="fas fa-users"></i> Driver vs Driver Battles</h2>
                    <p>Head-to-head performance comparisons and competitive analysis</p>
                </div>
                <button class="section-toggle" aria-label="Toggle section">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div class="charts-grid battles-grid section-content">
                <!-- Driver Duel Matrix -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-chess-board"></i> Driver Duel Matrix</h3>
                        <p class="chart-subtitle">Win/loss ratios per pair</p>
                    </div>
                    <div id="driverDuelMatrix" class="duel-matrix-container"></div>
                </div>

                <!-- Position Swap Timeline -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-exchange-alt"></i> Position Swap Timeline</h3>
                        <div class="chart-controls">
                            <select id="battleSessionSelect">
                                <option value="">Select Session</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="positionSwapChart"></canvas>
                </div>

                <!-- Gap vs Time -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-stopwatch"></i> Gap vs Time</h3>
                        <div class="chart-controls">
                            <select id="driver1BattleSelect">
                                <option value="">Driver 1</option>
                            </select>
                            <select id="driver2BattleSelect">
                                <option value="">Driver 2</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="gapVsTimeChart"></canvas>
                </div>

                <!-- Battle Heatmap -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-fire"></i> Battle Intensity</h3>
                        <p class="chart-subtitle">Close gaps < 0.2s</p>
                    </div>
                    <div id="battleHeatmap" class="heatmap-container"></div>
                </div>

                <!-- Average Gap Per Session -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-bar"></i> Average Gap Per Session</h3>
                    </div>
                    <canvas id="avgGapSessionChart"></canvas>
                </div>
            </div>
        </section>

        <!-- ========== 5. FINANCIAL & EFFICIENCY METRICS ========== -->
        <section class="section financial-section charts-loading collapsed" data-aos="fade-up" data-aos-delay="600">
            <div class="section-header" onclick="toggleSection(this)">
                <div>
                    <h2><i class="fas fa-euro-sign"></i> Financial & Efficiency Metrics</h2>
                    <p>Cost-effectiveness analysis and ROI evaluation</p>
                </div>
                <button class="section-toggle" aria-label="Toggle section">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div class="charts-grid financial-grid section-content">
                <!-- Cost per Lap Distribution -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-coins"></i> Cost per Lap Distribution</h3>
                    </div>
                    <canvas id="costPerLapChart"></canvas>
                </div>

                <!-- Cost vs Performance -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-scatter"></i> Cost vs Performance</h3>
                    </div>
                    <canvas id="costVsPerformanceChart"></canvas>
                </div>

                <!-- Heat Price vs Average Lap Time -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-thermometer-half"></i> Heat Price vs Lap Time</h3>
                    </div>
                    <canvas id="heatPriceChart"></canvas>
                </div>

                <!-- Total Spend per Driver -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-wallet"></i> Total Spend per Driver</h3>
                    </div>
                    <canvas id="totalSpendChart"></canvas>
                </div>

                <!-- Cost Efficiency Index -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-calculator"></i> Cost Efficiency Index</h3>
                        <p class="chart-subtitle">Best lap / Heat price ratio</p>
                    </div>
                    <canvas id="costEfficiencyChart"></canvas>
                </div>

                <!-- Cost vs Track Type -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-building"></i> Cost vs Track Type</h3>
                    </div>
                    <canvas id="costTrackTypeChart"></canvas>
                </div>
            </div>
        </section>

        <!-- ========== 6. TEMPORAL ANALYTICS ========== -->
        <section class="section temporal-section charts-loading collapsed" data-aos="fade-up" data-aos-delay="700">
            <div class="section-header" onclick="toggleSection(this)">
                <div>
                    <h2><i class="fas fa-calendar-alt"></i> Temporal Analytics</h2>
                    <p>Track progress and trends over time periods</p>
                </div>
                <button class="section-toggle" aria-label="Toggle section">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div class="charts-grid temporal-grid section-content">
                <!-- Lap Time Progression Over Weeks -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-line"></i> Weekly Progression</h3>
                    </div>
                    <canvas id="weeklyProgressChart"></canvas>
                </div>

                <!-- Session Frequency per Driver -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-calendar-check"></i> Session Frequency</h3>
                    </div>
                    <canvas id="sessionFrequencyChart"></canvas>
                </div>

                <!-- Calendar Heatmap -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-calendar"></i> Racing Calendar Heatmap</h3>
                    </div>
                    <div id="calendarHeatmap" class="calendar-heatmap-container"></div>
                </div>

                <!-- Day of Week Performance -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-calendar-week"></i> Day of Week Performance</h3>
                    </div>
                    <canvas id="dayOfWeekChart"></canvas>
                </div>

                <!-- Monthly Improvement Rate -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-trending-up"></i> Monthly Improvement</h3>
                    </div>
                    <canvas id="monthlyImprovementChart"></canvas>
                </div>

                <!-- Weather vs Lap Time Trend -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-cloud-rain"></i> Weather Trends</h3>
                    </div>
                    <canvas id="weatherTrendChart"></canvas>
                </div>
            </div>
        </section>

        <!-- ========== 7. SESSION SUMMARY WIDGETS ========== -->
        <section class="section session-widgets-section charts-loading collapsed" data-aos="fade-up" data-aos-delay="800">
            <div class="section-header" onclick="toggleSection(this)">
                <div>
                    <h2><i class="fas fa-th-large"></i> Session Summary Widgets</h2>
                    <p>Detailed performance cards for each session</p>
                </div>
                <button class="section-toggle" aria-label="Toggle section">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div id="sessionWidgetsContainer" class="session-widgets-grid section-content"></div>
        </section>

        <!-- ========== 8. ADVANCED / PREDICTIVE ANALYTICS ========== -->
        <section class="section predictive-section charts-loading collapsed" data-aos="fade-up" data-aos-delay="900">
            <div class="section-header" onclick="toggleSection(this)">
                <div>
                    <h2><i class="fas fa-crystal-ball"></i> Advanced / Predictive Analytics</h2>
                    <p>AI-powered insights and performance predictions</p>
                </div>
                <button class="section-toggle" aria-label="Toggle section">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div class="charts-grid predictive-grid section-content">
                <!-- Predicted Best Lap -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-robot"></i> Predicted Best Lap</h3>
                        <p class="chart-subtitle">ML regression model</p>
                    </div>
                    <canvas id="predictedLapChart"></canvas>
                </div>

                <!-- Driver Form Index -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-line"></i> Driver Form Index</h3>
                        <p class="chart-subtitle">Weighted recent performance</p>
                    </div>
                    <canvas id="driverFormChart"></canvas>
                </div>

                <!-- Weather Adjustment Model -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-cloud"></i> Weather Adjustment</h3>
                    </div>
                    <canvas id="weatherAdjustmentChart"></canvas>
                </div>

                <!-- Fatigue Model -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-battery-quarter"></i> Fatigue Model</h3>
                        <p class="chart-subtitle">Lap time degradation prediction</p>
                    </div>
                    <canvas id="fatigueModelChart"></canvas>
                </div>

                <!-- Pitstop Simulation -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-tools"></i> Pitstop Simulation</h3>
                        <p class="chart-subtitle">Optimal rest intervals</p>
                    </div>
                    <canvas id="pitstopSimChart"></canvas>
                </div>
            </div>
        </section>

        <!-- ========== 9. GEOGRAPHICAL EXPANSION (BENELUX) ========== -->
        <section class="section geographical-section charts-loading collapsed" data-aos="fade-up" data-aos-delay="1000">
            <div class="section-header" onclick="toggleSection(this)">
                <div>
                    <h2><i class="fas fa-globe-europe"></i> Benelux Regional Analysis</h2>
                    <p>Geographical insights across Belgium, Netherlands, and Luxembourg</p>
                </div>
                <button class="section-toggle" aria-label="Toggle section">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div class="charts-grid geographical-grid section-content">
                <!-- Map of Tracks -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-map"></i> Track Locations Map</h3>
                    </div>
                    <div id="trackMap" class="map-container"></div>
                </div>

                <!-- Regional Performance -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-flag"></i> Regional Performance</h3>
                    </div>
                    <canvas id="regionalPerformanceChart"></canvas>
                </div>

                <!-- Heat Price per Region -->
                <div class="chart-container medium">
                    <div class="chart-header">
                        <h3><i class="fas fa-euro-sign"></i> Regional Pricing</h3>
                    </div>
                    <canvas id="regionalPricingChart"></canvas>
                </div>

                <!-- Sessions per Track -->
                <div class="chart-container large">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-bar"></i> Track Utilization</h3>
                    </div>
                    <canvas id="trackUtilizationChart"></canvas>
                </div>
            </div>
        </section>

        <!-- ========== LEADERBOARDS & HIGHLIGHTS ========== -->
        <section class="section leaderboards-section charts-loading collapsed" data-aos="fade-up" data-aos-delay="1100">
            <div class="section-header" onclick="toggleSection(this)">
                <div>
                    <h2><i class="fas fa-medal"></i> Leaderboards & Highlights</h2>
                    <p>Real-time rankings and performance highlights</p>
                </div>
                <button class="section-toggle" aria-label="Toggle section">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div class="leaderboards-container section-content">
                <div class="leaderboard-card">
                    <h3><i class="fas fa-trophy"></i> Fastest Lap Champions</h3>
                    <div id="fastestLapLeaderboard" class="leaderboard-list"></div>
                </div>
                <div class="leaderboard-card">
                    <h3><i class="fas fa-fire"></i> Most Active Racers</h3>
                    <div id="mostActiveLeaderboard" class="leaderboard-list"></div>
                </div>
                <div class="leaderboard-card">
                    <h3><i class="fas fa-bullseye"></i> Consistency Masters</h3>
                    <div id="consistencyLeaderboard" class="leaderboard-list"></div>
                </div>
                <div class="leaderboard-card">
                    <h3><i class="fas fa-coins"></i> Value Champions</h3>
                    <div id="valueLeaderboard" class="leaderboard-list"></div>
                </div>
            </div>
        </section>

        <!-- ========== DATA TABLE ========== -->
        <section class="section data-table-section charts-loading collapsed" data-aos="fade-up" data-aos-delay="1200">
            <div class="section-header" onclick="toggleSection(this)">
                <div>
                    <h2><i class="fas fa-table"></i> Raw Data Explorer</h2>
                    <p>Sortable, filterable, and exportable data table</p>
                </div>
                <button class="section-toggle" aria-label="Toggle section">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="section-content">
                <div class="table-controls">
                    <button id="exportCSV" class="export-btn">
                        <i class="fas fa-file-csv"></i> Export CSV
                    </button>
                    <button id="exportExcel" class="export-btn">
                        <i class="fas fa-file-excel"></i> Export Excel
                    </button>
                    <input type="text" id="tableSearch" class="table-search" placeholder="Search data...">
                </div>
                <div class="data-table-wrapper">
                    <table id="mainDataTable" class="data-table">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ========== MOBILE MINI-DASHBOARD ========== -->
        <div id="mobileDashboard" class="mobile-mini-dashboard">
            <div class="mobile-header">
                <h3>üèÅ Quick Stats</h3>
                <button id="closeMobile" class="close-mobile">√ó</button>
            </div>
            <div class="mobile-stats">
                <div class="mobile-stat">
                    <span class="mobile-value" id="mobileBestLap">--</span>
                    <span class="mobile-label">Best Lap</span>
                </div>
                <div class="mobile-stat">
                    <span class="mobile-value" id="mobileLastSession">--</span>
                    <span class="mobile-label">Last Session</span>
                </div>
                <div class="mobile-stat">
                    <span class="mobile-value" id="mobileUpcoming">--</span>
                    <span class="mobile-label">Next Event</span>
                </div>
            </div>
        </div>

        <!-- Mobile Toggle Button -->
        <button id="showMobile" class="mobile-toggle">
            <i class="fas fa-mobile-alt"></i>
        </button>
    </div>

    <!-- Critical Scripts: Load immediately -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <!-- Core Module: Global state, theme, utilities (MUST load first) -->
    <script src="js/core.js"></script>
    
    <!-- Main Script: Data loading, filters, KPI, UI (loads immediately) -->
    <script src="script.js"></script>
    
    <!-- Lazy Load Charts: Load when user scrolls to chart sections -->
    <script>
        // Chart lazy loading configuration
        let chartsLoaded = false;
        
        function loadChartScripts() {
            if (chartsLoaded) return;
            chartsLoaded = true;
            
            console.log('Loading chart modules...');
            
            const chartScripts = [
                'js/charts-driver.js',
                'js/charts-session.js',
                'js/charts-track.js',
                'js/charts-battles.js',
                'js/charts-financial.js',
                'js/charts-temporal.js',
                'js/charts-predictive.js',
                'js/charts-geo.js'
            ];
            
            // Load scripts sequentially to maintain dependencies
            let loadPromise = Promise.resolve();
            chartScripts.forEach(src => {
                loadPromise = loadPromise.then(() => {
                    return new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = src;
                        script.onload = resolve;
                        script.onerror = reject;
                        document.body.appendChild(script);
                    });
                });
            });
            
            loadPromise.then(() => {
                console.log('‚úÖ All chart modules loaded');
                
                // Remove loading state from sections
                document.querySelectorAll('.section.charts-loading').forEach(section => {
                    section.classList.remove('charts-loading');
                });
                
                // Initialize all charts
                if (typeof window.initializeAllCharts === 'function') {
                    console.log('üéØ Calling initializeAllCharts...');
                    window.initializeAllCharts();
                } else {
                    console.error('‚ùå initializeAllCharts function not found!');
                }
            }).catch(error => {
                console.error('‚ùå Error loading chart modules:', error);
            });
        }
        
        // Intersection Observer to detect when user scrolls near charts
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    loadChartScripts();
                    observer.disconnect(); // Only load once
                }
            });
        }, {
            rootMargin: '800px' // Start loading 800px before reaching charts (much earlier)
        });
        
        // Observe the first chart section
        window.addEventListener('DOMContentLoaded', () => {
            const firstChartSection = document.querySelector('.driver-performance-section');
            if (firstChartSection) {
                observer.observe(firstChartSection);
            }
            
            // Also load after a short delay if user hasn't scrolled yet
            setTimeout(() => {
                if (!chartsLoaded) {
                    console.log('üïê Auto-loading charts after 2 seconds...');
                    loadChartScripts();
                }
            }, 2000);
            
            // Also load if user is already scrolled down
            if (window.scrollY > 200) {
                loadChartScripts();
            }
        });
    </script>
</body>
</html>