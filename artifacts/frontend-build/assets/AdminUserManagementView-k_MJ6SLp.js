import{d as J,k as Q,o as l,c as n,e as s,f as R,t as r,F as M,n as F,D as S,i as u,s as W,w as A,g as k,v as w,J as G,r as c,l as m}from"./index-BIUjLROW.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"user-management-view"},O={class:"header"},X={key:0,class:"loading-state"},Y={key:1},Z={key:0,class:"alert-card warning"},ee={class:"alert-header"},se={class:"unconnected-list"},ae={class:"driver-name"},te={key:0,class:"driver-nickname"},le={key:1,class:"driver-tracks"},ne=["onClick"],oe={key:0,class:"alert-more"},re={class:"users-list"},ie={class:"user-header"},de={class:"user-avatar"},ce={class:"user-info"},ue={class:"user-email"},ve={class:"user-stats"},me={class:"stat"},pe={class:"user-actions"},_e=["onClick"],ke=["onClick"],ye={key:0,class:"user-drivers"},he={class:"drivers-grid"},fe={class:"driver-name"},be={key:0,class:"driver-nickname"},Ce={class:"driver-laps"},we=["onClick"],ge=["onClick"],De={key:1,class:"no-drivers"},Ue=["onClick"],Me={class:"modal"},Fe={class:"modal-header"},xe={class:"modal-body"},Ve={class:"form-group"},$e={class:"form-group"},Ne={class:"form-group"},Se={key:0,class:"form-group"},Ae={key:1,class:"form-group"},Ee={class:"modal-footer"},Le=["disabled"],Ie={class:"modal"},Te={class:"modal-header"},Be={class:"modal-body"},qe={class:"search-box"},ze={class:"search-input-wrapper"},Pe={key:0,class:"drivers-list"},je={class:"driver-details"},Je={class:"driver-name"},Qe={key:0,class:"driver-nickname"},Re={class:"driver-laps"},We={key:1,class:"driver-tracks"},Ge=["onClick"],He={key:1,class:"loading-state"},Ke={key:2,class:"no-results"},Oe=J({__name:"AdminUserManagementView",setup(Xe){const x=c(!1),g=c(!1),D=c(!1),y=c([]),p=c([]),V=c(!1),v=c(!1),_=c(!1),h=c(null),$=c([]),f=c([]),b=c(""),d=c({id:null,name:"",email:"",role:"driver",password:""}),E=t=>t.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),C=async()=>{x.value=!0;try{y.value=await m.adminUsers.getAll()}catch(t){console.error("Failed to load users:",t),alert("Failed to load users")}finally{x.value=!1}await L()},L=async()=>{try{const t=await m.getDrivers(),e=new Set;y.value.forEach(i=>{var a;(a=i.drivers)==null||a.forEach(o=>{e.add(o.id)})}),p.value=t.filter(i=>!e.has(i.id))}catch(t){console.error("Failed to load unconnected drivers:",t)}},I=t=>{if(y.value.length===0){alert("No users available to connect to");return}const e=y.value[0];e&&(h.value=e,_.value=!0,b.value=t.name,D.value=!0,N(e))},T=t=>{d.value={id:t.id,name:t.name,email:t.email,role:t.role,password:""},v.value=!0},B=async t=>{var e,i;if(confirm(`Delete user "${t.name}"? This cannot be undone.`))try{await m.adminUsers.delete(t.id),await C(),alert("User deleted successfully")}catch(a){alert(((i=(e=a.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to delete user")}},q=async()=>{var t,e;g.value=!0;try{v.value&&d.value.id?await m.adminUsers.update(d.value.id,d.value):await m.adminUsers.create(d.value),await C(),U(),alert(v.value?"User updated successfully":"User created successfully")}catch(i){alert(((e=(t=i.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to save user")}finally{g.value=!1}},U=()=>{V.value=!1,v.value=!1,d.value={id:null,name:"",email:"",role:"driver",password:""}},N=async t=>{h.value=t,_.value=!0,b.value="",D.value=!0;try{const e=await m.adminUsers.availableDrivers(t.id);$.value=e,f.value=e}catch(e){console.error("Failed to load available drivers:",e)}finally{D.value=!1}},z=()=>{const t=b.value.toLowerCase().trim();if(!t){f.value=$.value;return}f.value=$.value.filter(e=>{var o;const i=e.name.toLowerCase().includes(t),a=(o=e.nickname)==null?void 0:o.toLowerCase().includes(t);return i||a})},P=async t=>{var e,i;if(h.value)try{await m.adminUsers.connectDriver(h.value.id,t),await C(),_.value=!1,alert("Driver connected successfully")}catch(a){alert(((i=(e=a.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to connect driver")}},j=async(t,e)=>{var i,a;if(confirm("Disconnect this driver?"))try{await m.adminUsers.disconnectDriver(t,e),await C(),alert("Driver disconnected")}catch(o){alert(((a=(i=o.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to disconnect driver")}};return Q(()=>{C()}),(t,e)=>{var i;return l(),n("div",K,[s("div",O,[e[10]||(e[10]=s("h1",null,"ðŸ‘¥ User Management",-1)),s("button",{onClick:e[0]||(e[0]=a=>V.value=!0),class:"btn-primary"},[...e[9]||(e[9]=[s("span",null,"âž•",-1),R(" Create User ",-1)])])]),x.value?(l(),n("div",X,[...e[11]||(e[11]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading users...",-1)])])):(l(),n("div",Y,[p.value.length>0?(l(),n("div",Z,[s("div",ee,[e[12]||(e[12]=s("span",{class:"alert-icon"},"âš ï¸",-1)),s("h3",null,r(p.value.length)+" Driver(s) Without User Accounts",1)]),e[13]||(e[13]=s("p",{class:"alert-text"},"These drivers were created but not connected to any user account:",-1)),s("div",se,[(l(!0),n(M,null,F(p.value.slice(0,10),a=>(l(),n("div",{key:a.id,class:"unconnected-item"},[s("div",{class:"driver-color",style:S({backgroundColor:a.color||"#666"})},null,4),s("span",ae,r(a.name),1),a.nickname?(l(),n("span",te,"("+r(a.nickname)+")",1)):u("",!0),a.track_names?(l(),n("span",le,"ðŸ“ "+r(a.track_names),1)):u("",!0),s("button",{onClick:o=>I(a),class:"btn-xs btn-success"},"Connect",8,ne)]))),128))]),p.value.length>10?(l(),n("p",oe," + "+r(p.value.length-10)+" more... ",1)):u("",!0)])):u("",!0),s("div",re,[(l(!0),n(M,null,F(y.value,a=>(l(),n("div",{key:a.id,class:"user-card"},[s("div",ie,[s("div",de,r(E(a.name)),1),s("div",ce,[s("h3",null,r(a.name),1),s("p",ue,r(a.email),1),s("span",{class:W(["role-badge",a.role])},r(a.role),3)]),s("div",ve,[s("span",me,r(a.drivers_count)+" drivers",1)]),s("div",pe,[s("button",{onClick:o=>T(a),class:"btn-sm btn-primary",title:"Edit user"}," âœï¸ ",8,_e),s("button",{onClick:o=>B(a),class:"btn-sm btn-danger",title:"Delete user"}," ðŸ—‘ï¸ ",8,ke)])]),a.drivers&&a.drivers.length>0?(l(),n("div",ye,[e[14]||(e[14]=s("h4",null,"Connected Drivers:",-1)),s("div",he,[(l(!0),n(M,null,F(a.drivers,o=>(l(),n("div",{key:o.id,class:"driver-chip"},[s("div",{class:"driver-color",style:S({backgroundColor:o.color||"#666"})},null,4),s("span",fe,r(o.name),1),o.nickname?(l(),n("span",be,"("+r(o.nickname)+")",1)):u("",!0),s("span",Ce,r(o.laps_count)+" laps",1),s("button",{onClick:Ye=>j(a.id,o.id),class:"remove-btn",title:"Disconnect"},"Ã—",8,we)]))),128))]),s("button",{onClick:o=>N(a),class:"btn-sm btn-success"}," âž• Connect Driver ",8,ge)])):(l(),n("div",De,[e[15]||(e[15]=s("p",null,"No drivers connected",-1)),s("button",{onClick:o=>N(a),class:"btn-sm btn-success"}," âž• Connect First Driver ",8,Ue)]))]))),128))])])),V.value||v.value?(l(),n("div",{key:2,class:"modal-overlay",onClick:A(U,["self"])},[s("div",Me,[s("div",Fe,[s("h2",null,r(v.value?"Edit User":"Create User"),1),s("button",{onClick:U,class:"close-btn"},"Ã—")]),s("div",xe,[s("div",Ve,[e[16]||(e[16]=s("label",null,"Name",-1)),k(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>d.value.name=a),type:"text",class:"form-input",placeholder:"Full name"},null,512),[[w,d.value.name]])]),s("div",$e,[e[17]||(e[17]=s("label",null,"Email",-1)),k(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>d.value.email=a),type:"email",class:"form-input",placeholder:"email@example.com"},null,512),[[w,d.value.email]])]),s("div",Ne,[e[19]||(e[19]=s("label",null,"Role",-1)),k(s("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>d.value.role=a),class:"form-input"},[...e[18]||(e[18]=[s("option",{value:"driver"},"Driver",-1),s("option",{value:"admin"},"Admin",-1)])],512),[[G,d.value.role]])]),v.value?u("",!0):(l(),n("div",Se,[e[20]||(e[20]=s("label",null,"Password",-1)),k(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>d.value.password=a),type:"password",class:"form-input",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"},null,512),[[w,d.value.password]])])),v.value?(l(),n("div",Ae,[e[21]||(e[21]=s("label",null,"New Password (leave blank to keep current)",-1)),k(s("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>d.value.password=a),type:"password",class:"form-input",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"},null,512),[[w,d.value.password]])])):u("",!0)]),s("div",Ee,[s("button",{onClick:U,class:"btn-secondary"},"Cancel"),s("button",{onClick:q,class:"btn-primary",disabled:g.value},r(g.value?"Saving...":v.value?"Update":"Create"),9,Le)])])])):u("",!0),_.value?(l(),n("div",{key:3,class:"modal-overlay",onClick:e[8]||(e[8]=A(a=>_.value=!1,["self"]))},[s("div",Ie,[s("div",Te,[s("h2",null,"Connect Driver to "+r((i=h.value)==null?void 0:i.name),1),s("button",{onClick:e[6]||(e[6]=a=>_.value=!1),class:"close-btn"},"Ã—")]),s("div",Be,[s("div",qe,[s("div",ze,[e[22]||(e[22]=s("i",{class:"search-icon"},"ðŸ”",-1)),k(s("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>b.value=a),onInput:z,type:"text",placeholder:"Search drivers...",class:"form-input search-input"},null,544),[[w,b.value]])])]),f.value.length>0?(l(),n("div",Pe,[(l(!0),n(M,null,F(f.value,a=>(l(),n("div",{key:a.id,class:"driver-item"},[s("div",{class:"driver-color",style:S({backgroundColor:a.color||"#666"})},null,4),s("div",je,[s("span",Je,r(a.name),1),a.nickname?(l(),n("span",Qe,r(a.nickname),1)):u("",!0),s("span",Re,r(a.laps_count)+" laps",1),a.track_names?(l(),n("span",We,"ðŸ“ "+r(a.track_names),1)):u("",!0)]),s("button",{onClick:o=>P(a.id),class:"btn-sm btn-success"}," Connect ",8,Ge)]))),128))])):D.value?(l(),n("div",He," Loading drivers... ")):(l(),n("div",Ke," No available drivers found "))])])])):u("",!0)])}}}),ss=H(Oe,[["__scopeId","data-v-4958f9d8"]]);export{ss as default};
