import{d as Z,k as $,C as M,A as j,o,c as r,e as s,g as L,J as R,b as q,F as N,n as x,t as l,h as S,i as d,D as z,f as G,r as i,y as J,G as V}from"./index-BIUjLROW.js";import{C as g,r as K}from"./chart-DaPPa1q0.js";import{u as O}from"./useChartConfig-CCFcitaf.js";import{u as H}from"./useKartingAPI-uF34JNNR.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./driverColors-pQD1MuRz.js";const X={class:"track-performance-view"},Y={class:"filters"},tt={class:"filter-group"},et={class:"filter-group"},st=["value"],at={key:0,class:"loading-state"},ot={key:1,class:"error-state"},rt={key:2,class:"charts-section"},lt={class:"chart-container"},nt={class:"chart-container"},it={class:"chart-container"},dt={class:"chart-container"},ct={key:3,class:"tracks-grid"},pt={class:"track-header"},ut={class:"track-location"},vt={key:0},_t={class:"track-stats"},mt={class:"stat-item"},gt={class:"stat-value highlight"},ft={key:0,class:"stat-subtext"},kt={class:"stat-item"},ht={class:"stat-value"},yt={class:"stat-item"},bt={class:"stat-value"},Ct={class:"stat-item"},Tt={class:"stat-value"},At={class:"stat-item"},St={class:"stat-value"},Bt={class:"stat-item"},Ft={class:"stat-value"},wt={class:"track-details"},Dt={key:0,class:"detail-item"},It={key:1,class:"detail-item"},Lt={key:2,class:"detail-item"},Rt={key:3,class:"detail-item"},Nt={key:4,class:"empty-state"},xt=Z({__name:"TrackPerformanceView",setup(Vt){g.register(...K);const{getColor:c}=O(),{getTrackStats:P,loading:U,error:B}=H(),p=i([]),F=i([]),f=i(""),k=i("total_laps"),y=i(),b=i(),C=i(),T=i();let u=null,v=null,_=null,m=null;const w=J(()=>{const a=[...p.value];switch(k.value){case"avg_lap_time":return a.sort((e,t)=>(e.avg_lap_time||1/0)-(t.avg_lap_time||1/0));case"track_record":return a.sort((e,t)=>(e.track_record||1/0)-(t.track_record||1/0));case"avg_speed_kmh":return a.sort((e,t)=>(t.avg_speed_kmh||0)-(e.avg_speed_kmh||0));case"total_sessions":return a.sort((e,t)=>t.total_sessions-e.total_sessions);case"total_laps":default:return a.sort((e,t)=>t.total_laps-e.total_laps)}});async function A(){f.value&&parseInt(f.value);const a=await P();p.value=a||[],await V(),I()}async function W(){try{const e=await(await fetch("http://127.0.0.1:8000/api/drivers",{headers:{Authorization:`Bearer ${localStorage.getItem("api_token")}`,Accept:"application/json"}})).json();F.value=e.data||e||[]}catch(a){console.error("Failed to load drivers:",a)}}function D(){V(()=>{I()})}function I(){if(p.value.length===0)return;const a=w.value;if(u&&u.destroy(),v&&v.destroy(),_&&_.destroy(),m&&m.destroy(),y.value){const e=a.filter(t=>t.track_record).slice(0,10);u=new g(y.value,{type:"bar",data:{labels:e.map(t=>t.track_name),datasets:[{label:"Track Record (seconds)",data:e.map(t=>t.track_record),backgroundColor:e.map((t,n)=>c(n)),borderColor:e.map((t,n)=>c(n)),borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:t=>h(Number(t))}}}}})}if(b.value){const e=a.filter(t=>t.avg_lap_time).slice(0,10);v=new g(b.value,{type:"bar",data:{labels:e.map(t=>t.track_name),datasets:[{label:"Average Lap Time (seconds)",data:e.map(t=>t.avg_lap_time),backgroundColor:e.map((t,n)=>c(n)),borderColor:e.map((t,n)=>c(n)),borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:t=>h(Number(t))}}}}})}if(C.value){const e=a.filter(t=>t.avg_speed_kmh).slice(0,10);_=new g(C.value,{type:"bar",data:{labels:e.map(t=>t.track_name),datasets:[{label:"Average Speed (km/h)",data:e.map(t=>t.avg_speed_kmh),backgroundColor:e.map((t,n)=>c(n)),borderColor:e.map((t,n)=>c(n)),borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})}if(T.value){const e=a.slice(0,10);m=new g(T.value,{type:"radar",data:{labels:e.map(t=>t.track_name),datasets:[{label:"Total Sessions",data:e.map(t=>t.total_sessions),backgroundColor:"rgba(255, 107, 53, 0.2)",borderColor:"#FF6B35",borderWidth:2,pointBackgroundColor:"#FF6B35"},{label:"Total Laps",data:e.map(t=>t.total_laps),backgroundColor:"rgba(16, 185, 129, 0.2)",borderColor:"#10B981",borderWidth:2,pointBackgroundColor:"#10B981"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{r:{beginAtZero:!0}}}})}}function E(a){const e=["#FF6B35","#10B981","#4F46E5","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#84CC16"],t=a.length%e.length;return e[t]||"#FF6B35"}function h(a){if(!a)return"N/A";const e=Math.floor(a/60),t=(a%60).toFixed(3);return e>0?`${e}:${t.padStart(6,"0")}`:`${t}s`}return $(async()=>{await Promise.all([A(),W()])}),M(()=>{u&&u.destroy(),v&&v.destroy(),_&&_.destroy(),m&&m.destroy()}),j(k,D),(a,e)=>(o(),r("div",X,[e[18]||(e[18]=s("header",{class:"page-header"},[s("h1",null,"üèÅ Track Performance Analysis"),s("p",null,"Compare lap times, speeds, and performance across all tracks")],-1)),s("div",Y,[s("div",tt,[e[3]||(e[3]=s("label",null,"Sort by:",-1)),L(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),onChange:D,class:"filter-select"},[...e[2]||(e[2]=[q('<option value="total_laps" data-v-96e26c9a>Total Laps</option><option value="avg_lap_time" data-v-96e26c9a>Average Lap Time</option><option value="track_record" data-v-96e26c9a>Track Record</option><option value="avg_speed_kmh" data-v-96e26c9a>Average Speed</option><option value="total_sessions" data-v-96e26c9a>Total Sessions</option>',5)])],544),[[R,k.value]])]),s("div",et,[e[5]||(e[5]=s("label",null,"Filter driver:",-1)),L(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),onChange:A,class:"filter-select"},[e[4]||(e[4]=s("option",{value:""},"All Drivers",-1)),(o(!0),r(N,null,x(F.value,t=>(o(),r("option",{key:t.id,value:t.id},l(t.name),9,st))),128))],544),[[R,f.value]])])]),S(U)?(o(),r("div",at,[...e[6]||(e[6]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading track performance data...",-1)])])):S(B)?(o(),r("div",ot,[s("p",null,"‚ùå "+l(S(B)),1),s("button",{onClick:A,class:"retry-btn"},"Retry")])):p.value.length>0?(o(),r("div",rt,[s("div",lt,[e[7]||(e[7]=s("h3",null,"üèÅ Track Records Comparison",-1)),s("canvas",{ref_key:"trackRecordsChart",ref:y},null,512)]),s("div",nt,[e[8]||(e[8]=s("h3",null,"‚è±Ô∏è Average Lap Times by Track",-1)),s("canvas",{ref_key:"avgLapTimesChart",ref:b},null,512)]),s("div",it,[e[9]||(e[9]=s("h3",null,"üöÄ Average Speeds by Track",-1)),s("canvas",{ref_key:"avgSpeedsChart",ref:C},null,512)]),s("div",dt,[e[10]||(e[10]=s("h3",null,"üìä Activity by Track",-1)),s("canvas",{ref_key:"activityChart",ref:T},null,512)])])):d("",!0),p.value.length>0?(o(),r("div",ct,[(o(!0),r(N,null,x(w.value,t=>(o(),r("div",{key:t.track_id,class:"track-card",style:z({borderLeftColor:E(t.track_name)})},[s("div",pt,[s("h3",null,l(t.track_name),1),s("div",ut,[t.city?(o(),r("span",vt,l(t.city)+", ",1)):d("",!0),G(l(t.country||"Unknown"),1)])]),s("div",_t,[s("div",mt,[e[11]||(e[11]=s("span",{class:"stat-label"},"Track Record",-1)),s("span",gt,l(h(t.track_record)),1),t.record_holder?(o(),r("span",ft,"by "+l(t.record_holder),1)):d("",!0)]),s("div",kt,[e[12]||(e[12]=s("span",{class:"stat-label"},"Avg Lap Time",-1)),s("span",ht,l(h(t.avg_lap_time)),1)]),s("div",yt,[e[13]||(e[13]=s("span",{class:"stat-label"},"Avg Speed",-1)),s("span",bt,l(t.avg_speed_kmh?t.avg_speed_kmh+" km/h":"N/A"),1)]),s("div",Ct,[e[14]||(e[14]=s("span",{class:"stat-label"},"Total Laps",-1)),s("span",Tt,l(t.total_laps),1)]),s("div",At,[e[15]||(e[15]=s("span",{class:"stat-label"},"Sessions",-1)),s("span",St,l(t.total_sessions),1)]),s("div",Bt,[e[16]||(e[16]=s("span",{class:"stat-label"},"Unique Drivers",-1)),s("span",Ft,l(t.unique_drivers),1)])]),s("div",wt,[t.distance?(o(),r("div",Dt,[s("span",null,"Distance: "+l(t.distance)+"m",1)])):d("",!0),t.corners?(o(),r("div",It,[s("span",null,"Corners: "+l(t.corners),1)])):d("",!0),t.indoor!==null?(o(),r("div",Lt,[s("span",null,l(t.indoor?"Indoor":"Outdoor"),1)])):d("",!0),t.total_distance_km?(o(),r("div",Rt,[s("span",null,"Total Distance: "+l(t.total_distance_km)+" km",1)])):d("",!0)])],4))),128))])):(o(),r("div",Nt,[...e[17]||(e[17]=[s("p",null,"üèÅ No track performance data available",-1),s("p",{class:"hint"},"Complete some karting sessions to see track performance analysis",-1)])]))]))}}),Mt=Q(xt,[["__scopeId","data-v-96e26c9a"]]);export{Mt as default};
