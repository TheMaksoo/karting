import{C,r as st}from"./chart-DaPPa1q0.js";import{u as et}from"./useChartConfig-CCFcitaf.js";import{u as at}from"./useKartingAPI-uF34JNNR.js";import{d as nt,k as ot,C as lt,o as B,c as O,e as t,t as i,f as k,F as rt,n as it,s as K,D as U,r as d,G as dt}from"./index-BIUjLROW.js";import{_ as ut}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./driverColors-pQD1MuRz.js";const ct={class:"financial-view"},mt={class:"summary-grid"},vt={class:"summary-card"},gt={class:"summary-content"},pt={class:"summary-value"},yt={class:"summary-card"},ht={class:"summary-content"},ft={class:"summary-value"},bt={class:"summary-trend"},_t={class:"summary-card"},Ct={class:"summary-content"},kt={class:"summary-value"},xt={class:"summary-trend"},St={class:"summary-card"},wt={class:"summary-content"},Mt={class:"summary-value"},Ft={class:"charts-grid"},Dt={class:"chart-card large"},At={class:"chart-card"},Tt={class:"chart-card"},Et={class:"chart-card full-width"},Lt={class:"expenses-card"},Bt={class:"expenses-header"},Ot={class:"table-wrapper"},$t={class:"expenses-table"},It={class:"amount-cell"},Pt={class:"goals-card"},jt={class:"goals-grid"},Yt={class:"goal-item"},Nt={class:"goal-header"},Vt={class:"goal-amount"},Rt={class:"goal-progress"},Kt={class:"progress-bar"},Ut={class:"progress-text"},zt={class:"goal-item"},Ht={class:"goal-header"},Gt={class:"goal-amount"},Wt={class:"goal-progress"},Zt={class:"progress-bar"},qt={class:"progress-text"},Jt=nt({__name:"FinancialView",setup(Qt){C.register(...st);const{getColor:c}=et(),{getAllLaps:z,getDriverStats:H,loading:$,error:I}=at(),G=d(!1),P=d(0),j=d(0),Y=d(0),N=d(0),V=d(0),R=d(0),v=d(500),g=d(0),x=d(4e3),S=d(0),p=d([]),F=d(),D=d(),A=d(),T=d();let y=null,h=null,f=null,b=null;const W=async()=>{try{$.value=!0,I.value="";const[e,s]=await Promise.all([z(),H()]);if(!e)throw new Error("Failed to load lap data for financial calculations");Z(e),q(e),J(),await dt(),Q(e)}catch(e){console.error("Error loading financial data:",e),I.value=e.message||"Failed to load financial data"}finally{$.value=!1}},Z=e=>{if(e.length===0)return;const s=w(e),a=Object.keys(s).length;V.value=a,R.value=e.length;const r=Object.values(s).map(u=>{const m=M(u),_=15,L=Math.max(1,m/30);return _*L}).reduce((u,m)=>u+m,0);P.value=Math.round(r*100)/100,j.value=a>0?Math.round(r/a*100)/100:0,Y.value=e.length>0?Math.round(r/e.length*100)/100:0;const n=E(e),l=Object.values(n);N.value=l.length>0?Math.round(l.reduce((u,m)=>u+m,0)/l.length*100)/100:0},w=e=>e.reduce((s,a)=>{const o=a.session_id;return s[o]||(s[o]=[]),s[o].push(a),s},{}),M=e=>e.length===0?30:Math.max(30,e.length/12*60),E=e=>{const s={};return e.forEach(a=>{const o=new Date(a.created_at),r=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`;s[r]||(s[r]=0);const n=20,l=w([a]),u=M(l[a.session_id]);s[r]+=n*(u/60)}),s},q=e=>{const s=[],a=w(e);Object.entries(a).forEach(([o,r])=>{const n=r;if(n.length===0)return;const l=n[0],u=new Date(l.created_at),_=15+M(n)/60*10;s.push({id:parseInt(o),date:u.toISOString().split("T")[0]||"",track:l.track_name||"Unknown Track",category:"Session",description:`Karting session - ${n.length} laps`,amount:Math.round(_*100)/100}),Math.random()<.1&&s.push({id:parseInt(o)+1e4,date:u.toISOString().split("T")[0]||"",track:l.track_name||"Unknown Track",category:"Equipment",description:"Kart maintenance and tires",amount:Math.round((Math.random()*50+20)*100)/100})}),p.value=s.sort((o,r)=>new Date(r.date).getTime()-new Date(o.date).getTime())},J=()=>{const e=new Date,s=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`,a=e.getFullYear(),o=p.value.filter(n=>n.date.substring(0,7)===s);g.value=o.reduce((n,l)=>n+l.amount,0);const r=p.value.filter(n=>new Date(n.date).getFullYear()===a);S.value=r.reduce((n,l)=>n+l.amount,0)},Q=e=>{if(e.length!==0){if(y&&y.destroy(),h&&h.destroy(),f&&f.destroy(),b&&b.destroy(),F.value){const s=E(e),a=Object.keys(s).sort(),o=[];let r=0;a.forEach(n=>{r+=s[n]||0,o.push(r)}),y=new C(F.value,{type:"line",data:{labels:a.map(n=>{const[l,u]=n.split("-");return`${l}-${u}`}),datasets:[{label:"Cumulative Spending (â‚¬)",data:o,borderColor:c(0),backgroundColor:c(0)+"20",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0,ticks:{callback:n=>"â‚¬"+Number(n).toFixed(0)}}}}})}if(D.value){const s=p.value.reduce((a,o)=>(a[o.category]=(a[o.category]||0)+o.amount,a),{});h=new C(D.value,{type:"doughnut",data:{labels:Object.keys(s),datasets:[{data:Object.values(s),backgroundColor:[c(0),c(1),c(2),c(3)],borderWidth:2,borderColor:"rgba(255, 255, 255, 0.1)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})}if(A.value){const s=E(e),a=Object.keys(s).sort();f=new C(A.value,{type:"bar",data:{labels:a.map(o=>{const[r,n]=o.split("-");return`${r}-${n}`}),datasets:[{label:"Monthly Spending (â‚¬)",data:a.map(o=>s[o]||0),backgroundColor:c(0),borderColor:c(0),borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:o=>"â‚¬"+Number(o).toFixed(0)}}}}})}if(T.value){const s=w(e),a=Object.entries(s).sort(([n],[l])=>s[n][0].created_at.localeCompare(s[l][0].created_at));let o=0;const r=a.map(([n,l])=>{const u=l,m=15+M(u)/60*10;o+=m;const _=Math.min(...u.map(L=>L.lap_time));return{x:o,y:_}});b=new C(T.value,{type:"scatter",data:{datasets:[{label:"Cost vs Performance",data:r,backgroundColor:c(0),pointRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{title:{display:!0,text:"Cumulative Cost (â‚¬)"},ticks:{callback:n=>"â‚¬"+Number(n).toFixed(0)}},y:{title:{display:!0,text:"Best Lap Time (seconds)"},reverse:!0,ticks:{callback:n=>X(Number(n))}}}}})}}},X=e=>{if(!e||e===0)return"0.000";const s=Math.floor(e/60),a=(e%60).toFixed(3);return s>0?`${s}:${a.padStart(6,"0")}`:a},tt=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return ot(async()=>{await W()}),lt(()=>{y&&y.destroy(),h&&h.destroy(),f&&f.destroy(),b&&b.destroy()}),(e,s)=>(B(),O("div",ct,[s[24]||(s[24]=t("div",{class:"page-header"},[t("h1",null,"ðŸ’° Financial Analysis"),t("p",{class:"subtitle"},"Track costs and analyze your karting investment")],-1)),t("div",mt,[t("div",vt,[s[2]||(s[2]=t("div",{class:"summary-icon"},"ðŸ’³",-1)),t("div",gt,[t("div",pt,"â‚¬"+i(P.value.toLocaleString()),1),s[1]||(s[1]=t("div",{class:"summary-label"},"Total Spent",-1))]),s[3]||(s[3]=t("div",{class:"summary-trend"},[t("span",null,"ðŸ“ˆ"),k(" This Year ")],-1))]),t("div",yt,[s[6]||(s[6]=t("div",{class:"summary-icon"},"ðŸ’¶",-1)),t("div",ht,[t("div",ft,"â‚¬"+i(j.value.toFixed(2)),1),s[4]||(s[4]=t("div",{class:"summary-label"},"Avg Per Session",-1))]),t("div",bt,[s[5]||(s[5]=t("span",null,"ðŸ“Š",-1)),k(" "+i(V.value)+" sessions ",1)])]),t("div",_t,[s[9]||(s[9]=t("div",{class:"summary-icon"},"â±ï¸",-1)),t("div",Ct,[t("div",kt,"â‚¬"+i(Y.value.toFixed(2)),1),s[7]||(s[7]=t("div",{class:"summary-label"},"Cost Per Lap",-1))]),t("div",xt,[s[8]||(s[8]=t("span",null,"ðŸ",-1)),k(" "+i(R.value)+" laps ",1)])]),t("div",St,[s[11]||(s[11]=t("div",{class:"summary-icon"},"ðŸŽ¯",-1)),t("div",wt,[t("div",Mt,"â‚¬"+i(N.value.toFixed(2)),1),s[10]||(s[10]=t("div",{class:"summary-label"},"Monthly Average",-1))]),s[12]||(s[12]=t("div",{class:"summary-trend"},[t("span",null,"ðŸ“…"),k(" Last 12 months ")],-1))])]),t("div",Ft,[t("div",Dt,[s[13]||(s[13]=t("h3",null,"ðŸ“ˆ Spending Over Time",-1)),t("canvas",{ref_key:"spendingChart",ref:F},null,512)]),t("div",At,[s[14]||(s[14]=t("h3",null,"ðŸŽ¯ Cost Breakdown",-1)),t("canvas",{ref_key:"breakdownChart",ref:D},null,512)]),t("div",Tt,[s[15]||(s[15]=t("h3",null,"ðŸ“Š Monthly Spending",-1)),t("canvas",{ref_key:"monthlyChart",ref:A},null,512)]),t("div",Et,[s[16]||(s[16]=t("h3",null,"ðŸ’Ž Value Analysis",-1)),t("canvas",{ref_key:"valueChart",ref:T},null,512)])]),t("div",Lt,[t("div",Bt,[s[18]||(s[18]=t("h3",null,"ðŸ“ Expense History",-1)),t("button",{class:"btn-add",onClick:s[0]||(s[0]=a=>G.value=!0)},[...s[17]||(s[17]=[t("span",null,"âž•",-1),k(" Add Expense ",-1)])])]),t("div",Ot,[t("table",$t,[s[20]||(s[20]=t("thead",null,[t("tr",null,[t("th",null,"Date"),t("th",null,"Track"),t("th",null,"Category"),t("th",null,"Description"),t("th",null,"Amount"),t("th",null,"Actions")])],-1)),t("tbody",null,[(B(!0),O(rt,null,it(p.value,a=>(B(),O("tr",{key:a.id},[t("td",null,i(tt(a.date)),1),t("td",null,i(a.track),1),t("td",null,[t("span",{class:K(["category-badge",a.category])},i(a.category),3)]),t("td",null,i(a.description),1),t("td",It,"â‚¬"+i(a.amount.toFixed(2)),1),s[19]||(s[19]=t("td",null,[t("button",{class:"btn-icon-small",title:"Edit"},"âœï¸"),t("button",{class:"btn-icon-small danger",title:"Delete"},"ðŸ—‘ï¸")],-1))]))),128))])])])]),t("div",Pt,[s[23]||(s[23]=t("h3",null,"ðŸŽ¯ Budget Goals",-1)),t("div",jt,[t("div",Yt,[t("div",Nt,[s[21]||(s[21]=t("span",{class:"goal-title"},"Monthly Budget",-1)),t("span",Vt,"â‚¬"+i(v.value),1)]),t("div",Rt,[t("div",Kt,[t("div",{class:K(["progress-fill",{"over-budget":g.value>v.value}]),style:U({width:Math.min(g.value/v.value*100,100)+"%"})},null,6)]),t("div",Ut," â‚¬"+i(g.value.toFixed(2))+" / â‚¬"+i(v.value)+" ("+i((g.value/v.value*100).toFixed(0))+"%) ",1)])]),t("div",zt,[t("div",Ht,[s[22]||(s[22]=t("span",{class:"goal-title"},"Yearly Budget",-1)),t("span",Gt,"â‚¬"+i(x.value),1)]),t("div",Wt,[t("div",Zt,[t("div",{class:"progress-fill",style:U({width:Math.min(S.value/x.value*100,100)+"%"})},null,4)]),t("div",qt," â‚¬"+i(S.value.toFixed(2))+" / â‚¬"+i(x.value)+" ("+i((S.value/x.value*100).toFixed(0))+"%) ",1)])])])])]))}}),os=ut(Jt,[["__scopeId","data-v-9ea8f268"]]);export{os as default};
