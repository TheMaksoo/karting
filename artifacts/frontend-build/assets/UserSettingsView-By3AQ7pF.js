import{d as z,a as A,k as L,o as c,c as u,e,t as d,h,s as R,F,n as T,D as W,i as S,g,v as _,r as v,l as m}from"./index-BIUjLROW.js";const Y={class:"user-settings-view"},j={class:"settings-content"},q={class:"settings-section"},G={class:"profile-grid"},H={class:"profile-item"},J={class:"profile-value"},K={class:"profile-item"},O={class:"profile-value"},Q={class:"profile-item"},X={class:"profile-value"},Z={key:0,class:"profile-item full-width"},I={class:"connected-drivers-list"},ee={key:0,class:"nickname"},se={class:"settings-section"},ae={class:"form-group"},te={class:"form-group"},le={class:"form-group"},ne=["disabled"],oe={class:"settings-section"},re={class:"form-group"},ie=["disabled"],de={class:"settings-section"},ce={key:0,class:"loading-state"},ue={key:1,class:"track-nicknames-list"},ve={class:"track-info"},me={class:"track-details"},pe={class:"track-name"},we={class:"track-location"},fe={class:"nickname-input-group"},ke=["onUpdate:modelValue","placeholder"],ye=["onClick","disabled"],ge=["onClick","disabled"],be=z({__name:"UserSettingsView",setup(_e){const p=A(),f=v(""),b=v([]),k=v({}),y=v({}),P=v(!1),n=v(!1),C=v(!1),w=v([]),o=v({currentPassword:"",newPassword:"",confirmPassword:""}),U=async()=>{var t,s;P.value=!0;try{const l=await m.userSettings.get();f.value=l.display_name||((t=p.user)==null?void 0:t.name)||"",(s=l.track_nicknames)==null||s.forEach(r=>{k.value[r.track_id]=r.nickname,y.value[r.track_id]=r.id})}catch(l){console.error("Failed to load settings:",l)}finally{P.value=!1}},V=async()=>{try{const t=await m.tracks.getAll();if(w.value.length>0){const s=w.value.map(i=>i.id),l=await m.tracks.stats(),r=new Set;for(const i of l)i.total_sessions>0&&r.add(i.track_id);b.value=t.filter(i=>r.has(i.id))}else b.value=[]}catch(t){console.error("Failed to load tracks:",t)}},x=async()=>{var t,s;n.value=!0;try{await m.userSettings.updateDisplayName(f.value),alert("Display name saved successfully!"),p.user&&(p.user.display_name=f.value)}catch(l){alert(((s=(t=l.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to save display name")}finally{n.value=!1}},E=async t=>{var l,r;const s=k.value[t];if(!(s!=null&&s.trim())){alert("Please enter a nickname");return}n.value=!0;try{const i=await m.userSettings.setTrackNickname(t,s);y.value[t]=i.track_nickname.id,alert("Track nickname saved!")}catch(i){alert(((r=(l=i.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to save track nickname")}finally{n.value=!1}},B=async t=>{if(!confirm("Delete this track nickname?"))return;const s=y.value[t];if(s){n.value=!0;try{await m.userSettings.deleteTrackNickname(s),delete k.value[t],delete y.value[t],alert("Track nickname deleted!")}catch{alert("Failed to delete track nickname")}finally{n.value=!1}}},M=async()=>{C.value=!0;try{w.value=await m.getUserDrivers()}catch(t){console.error("Failed to load drivers:",t)}finally{C.value=!1}},$=async()=>{var t,s;if(!o.value.currentPassword.trim()){alert("Please enter your current password");return}if(o.value.newPassword.length<6){alert("New password must be at least 6 characters long");return}if(o.value.newPassword!==o.value.confirmPassword){alert("New passwords do not match");return}n.value=!0;try{await m.auth.changePassword({current_password:o.value.currentPassword,new_password:o.value.newPassword,new_password_confirmation:o.value.confirmPassword}),o.value={currentPassword:"",newPassword:"",confirmPassword:""},alert("Password changed successfully!")}catch(l){alert(((s=(t=l.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to change password")}finally{n.value=!1}};return L(async()=>{await U(),await M(),await V()}),(t,s)=>{var l,r,i,D;return c(),u("div",Y,[s[16]||(s[16]=e("div",{class:"settings-header"},[e("h1",null,"âš™ï¸ User Settings"),e("p",{class:"subtitle"},"Manage your account settings and preferences")],-1)),e("div",j,[e("div",q,[s[7]||(s[7]=e("div",{class:"section-header"},[e("h2",null,"Profile Information")],-1)),e("div",G,[e("div",H,[s[4]||(s[4]=e("label",null,"Name",-1)),e("div",J,d((l=h(p).user)==null?void 0:l.name),1)]),e("div",K,[s[5]||(s[5]=e("label",null,"Email",-1)),e("div",O,d((r=h(p).user)==null?void 0:r.email),1)]),e("div",Q,[s[6]||(s[6]=e("label",null,"Role",-1)),e("div",X,[e("span",{class:R(["role-badge",(i=h(p).user)==null?void 0:i.role])},d((D=h(p).user)==null?void 0:D.role),3)])]),w.value.length>0?(c(),u("div",Z,[e("label",null,"Connected Drivers ("+d(w.value.length)+")",1),e("div",I,[(c(!0),u(F,null,T(w.value,a=>(c(),u("div",{key:a.id,class:"driver-badge"},[e("div",{class:"driver-color-dot",style:W({backgroundColor:a.color||"#666"})},null,4),e("span",null,d(a.name),1),a.nickname?(c(),u("span",ee,"("+d(a.nickname)+")",1)):S("",!0)]))),128))])])):S("",!0)])]),e("div",se,[s[11]||(s[11]=e("div",{class:"section-header"},[e("h2",null,"Change Password")],-1)),e("div",ae,[s[8]||(s[8]=e("label",null,"Current Password",-1)),g(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>o.value.currentPassword=a),type:"password",placeholder:"Enter current password",class:"form-input"},null,512),[[_,o.value.currentPassword]])]),e("div",te,[s[9]||(s[9]=e("label",null,"New Password",-1)),g(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>o.value.newPassword=a),type:"password",placeholder:"Enter new password",class:"form-input"},null,512),[[_,o.value.newPassword]])]),e("div",le,[s[10]||(s[10]=e("label",null,"Confirm New Password",-1)),g(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>o.value.confirmPassword=a),type:"password",placeholder:"Confirm new password",class:"form-input"},null,512),[[_,o.value.confirmPassword]])]),e("button",{onClick:$,disabled:n.value,class:"btn-primary"},d(n.value?"Changing...":"Change Password"),9,ne)]),e("div",oe,[s[13]||(s[13]=e("div",{class:"section-header"},[e("h2",null,"Display Name")],-1)),e("div",re,[s[12]||(s[12]=e("label",null,"Your Display Name",-1)),g(e("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>f.value=a),type:"text",placeholder:"Enter your display name",class:"form-input"},null,512),[[_,f.value]]),e("button",{onClick:x,disabled:n.value,class:"btn-primary"},d(n.value?"Saving...":"Save Display Name"),9,ie)])]),e("div",de,[s[15]||(s[15]=e("div",{class:"section-header"},[e("h2",null,"Track Nicknames"),e("p",{class:"section-hint"},"Set different nicknames for each track you race at")],-1)),P.value?(c(),u("div",ce,"Loading tracks...")):(c(),u("div",ue,[(c(!0),u(F,null,T(b.value,a=>(c(),u("div",{key:a.id,class:"track-nickname-item"},[e("div",ve,[s[14]||(s[14]=e("div",{class:"track-icon"},"ðŸ",-1)),e("div",me,[e("div",pe,d(a.name),1),e("div",we,d(a.city)+", "+d(a.country),1)])]),e("div",fe,[g(e("input",{"onUpdate:modelValue":N=>k.value[a.id]=N,type:"text",placeholder:`Nickname at ${a.name}`,class:"form-input"},null,8,ke),[[_,k.value[a.id]]]),e("button",{onClick:N=>E(a.id),disabled:n.value,class:"btn-sm btn-primary"}," Save ",8,ye),y.value[a.id]?(c(),u("button",{key:0,onClick:N=>B(a.id),disabled:n.value,class:"btn-sm btn-danger"}," Delete ",8,ge)):S("",!0)])]))),128))]))])])])}}});export{be as default};
