import{C as w,r as tt}from"./chart-DaPPa1q0.js";import{u as et}from"./useChartConfig-CCFcitaf.js";import{u as it}from"./useKartingAPI-uF34JNNR.js";import{d as st,k as at,C as nt,o as P,c as C,e,t as v,D as $,b as ot,F as E,n as O,s as L,r as f,G as rt}from"./index-BIUjLROW.js";import{_ as ct}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./driverColors-pQD1MuRz.js";const dt={class:"predictive-view"},lt={class:"predictions-grid"},pt={class:"prediction-card featured"},mt={class:"prediction-value"},vt={class:"prediction-confidence"},ut={class:"confidence-text"},ht={class:"prediction-card"},ft={class:"prediction-value"},gt={class:"prediction-detail"},bt={class:"prediction-card"},yt={class:"prediction-value"},_t={class:"prediction-card"},kt={class:"prediction-value"},Pt={class:"charts-grid"},Ct={class:"chart-card large"},wt={class:"chart-card"},Tt={class:"chart-card"},Mt={class:"goals-prediction-card"},xt={class:"goals-timeline"},Dt={class:"goal-progress"},At={class:"goal-content"},Lt={class:"goal-header"},St={class:"goal-date"},Bt={class:"goal-description"},It={class:"goal-probability"},Rt={class:"probability-bar"},Ft={class:"probability-text"},$t={class:"recommendations-card"},Et={class:"recommendations-list"},Ot={class:"rec-content"},zt={class:"rec-title"},jt={class:"rec-description"},Ht={class:"rec-impact"},Nt={class:"impact-value"},Ut={class:"rec-priority"},Wt=st({__name:"PredictiveView",setup(Yt){w.register(...tt);const{getColor:u}=et(),{getDriverStats:z,getAllLaps:j,loading:S,error:B}=it(),h=f({nextBestLap:0,confidence:0,bestDay:"-",bestDayReason:"",podiumChance:0,improvementPotential:0}),I=f([]),R=f([]),T=f(),M=f(),x=f();let g=null,b=null,y=null;const H=async()=>{try{S.value=!0,B.value="";const[o,t]=await Promise.all([z(),j()]);if(!o||!t)throw new Error("Failed to load data for predictions");N(t),W(t),Y(t),await rt(),X(t)}catch(o){console.error("Error loading predictions:",o),B.value=o.message||"Failed to load predictions"}finally{S.value=!1}},N=o=>{if(o.length===0)return;const t=o.sort((k,A)=>new Date(k.created_at).getTime()-new Date(A.created_at).getTime()),a=t.slice(-20).map(k=>k.lap_time),s=Math.min(...a),n=a.reduce((k,A)=>k+A,0)/a.length,r=F(t),d=Math.max(.001,Math.abs(r.slope)*.1),p=s-d,l=D(a),c=Math.min(95,Math.max(60,l*100)),m=U(t),Z=m.day,K=`Average lap time: ${_(m.avgTime)} (${m.count} sessions)`,J=Math.min(85,Math.max(5,(1-(n-s)/n)*50)),Q=Math.max(.1,d*4);h.value={nextBestLap:p,confidence:Math.round(c),bestDay:Z,bestDayReason:K,podiumChance:Math.round(J),improvementPotential:Math.round(Q*100)/100}},F=o=>{const t=o.map((l,c)=>({x:c,y:l.lap_time})),i=t.length,a=t.reduce((l,c)=>l+c.x,0),s=t.reduce((l,c)=>l+c.y,0),n=t.reduce((l,c)=>l+c.x*c.y,0),r=t.reduce((l,c)=>l+c.x*c.x,0),d=(i*n-a*s)/(i*r-a*a),p=(s-d*a)/i;return{slope:d,intercept:p}},D=o=>{if(o.length<2)return .5;const t=o.reduce((s,n)=>s+n,0)/o.length,i=o.reduce((s,n)=>s+Math.pow(n-t,2),0)/o.length,a=Math.sqrt(i);return Math.max(.1,Math.min(1,1-a/t))},U=o=>{const t={};o.forEach(n=>{const r=new Date(n.created_at).toLocaleDateString("en-US",{weekday:"long"});t[r]||(t[r]={times:[],count:0}),t[r].times.push(n.lap_time),t[r].count++});let i="Unknown",a=1/0,s=0;return Object.entries(t).forEach(([n,r])=>{if(r.times.length>=3){const d=r.times.reduce((p,l)=>p+l,0)/r.times.length;d<a&&(a=d,i=n,s=r.count)}}),{day:i,avgTime:a,count:s}},W=o=>{if(o.length===0)return;const t=Math.min(...o.map(s=>s.lap_time)),i=o.slice(-10).reduce((s,n)=>s+n.lap_time,0)/Math.min(10,o.length),a=[{id:1,title:"Break Current Personal Best",description:`Achieve a lap time under ${_(t)}`,predictedDate:"2-3 weeks",probability:Math.min(80,Math.max(30,50+(i-t)/t*100)),status:"upcoming"},{id:2,title:"Consistent Sub-2:00 Laps",description:"Achieve 5 consecutive laps under 2:00.000",predictedDate:"4-6 weeks",probability:Math.min(70,Math.max(20,40+(1.95-i)/1.95*100)),status:"upcoming"},{id:3,title:"Top 3 Finisher",description:"Finish in top 3 in a competitive race",predictedDate:"6-8 weeks",probability:Math.min(60,Math.max(15,30+(i-t)/i*200)),status:"upcoming"}];I.value=a},Y=o=>{const t=[];if(o.length===0)return;const i=o.map(p=>p.lap_time);i.reduce((p,l)=>p+l,0)/i.length,Math.min(...i);const a=D(i),s=G(o),n=s.bestHour,r=V(o),d=r.bestTrack;t.push({icon:"â°",title:"Optimal Training Time",description:`Schedule sessions around ${n}:00 for best performance. Data shows ${s.improvement}% better times.`,impact:`${s.improvement.toFixed(1)}% faster laps`,priority:"high"}),t.push({icon:"ğŸ",title:"Focus Track Training",description:`Prioritize training at ${d} where you perform best. ${r.sessions} sessions analyzed.`,impact:`${r.improvement.toFixed(1)}% better consistency`,priority:"medium"}),a<.7&&t.push({icon:"ğŸ¯",title:"Improve Lap Consistency",description:"Work on reducing lap time variation. Focus on smooth driving lines and consistent corner speeds.",impact:"5-15% performance gain",priority:"high"}),i.length<50&&t.push({icon:"ğŸ“Š",title:"Increase Training Frequency",description:"More data points will improve prediction accuracy and help identify improvement opportunities.",impact:"Better insights & predictions",priority:"medium"}),R.value=t.slice(0,4)},G=o=>{const t={};o.forEach(d=>{const p=new Date(d.created_at).getHours();t[p]||(t[p]=[]),t[p].push(d.lap_time)});let i=14,a=1/0,s=0,n=0;Object.entries(t).forEach(([d,p])=>{if(p.length>=3){const l=p.reduce((c,m)=>c+m,0)/p.length;s+=l*p.length,n+=p.length,l<a&&(a=l,i=parseInt(d))}}),s/=n;const r=(s-a)/s*100;return{bestHour:i,improvement:r}},V=o=>{const t={};o.forEach(n=>{const r=n.track_name||"Unknown";t[r]||(t[r]=[]),t[r].push(n.lap_time)});let i="Unknown",a=0,s=0;return Object.entries(t).forEach(([n,r])=>{if(r.length>=5){const d=D(r);d>a&&(a=d,i=n,s=r.length)}}),{bestTrack:i,sessions:s,improvement:(a-.5)*100}},X=o=>{if(o.length!==0){if(g&&g.destroy(),b&&b.destroy(),y&&y.destroy(),T.value){const i=o.sort((c,m)=>new Date(c.created_at).getTime()-new Date(m.created_at).getTime()).slice(-30),a=i.map((c,m)=>`Lap ${m+1}`),s=i.map(c=>c.lap_time),n=F(i.map((c,m)=>({x:m,y:c.lap_time}))),r=i.map((c,m)=>n.intercept+n.slope*m),d=10,p=[...a,...Array.from({length:d},(c,m)=>`Pred ${m+1}`)],l=[...r,...Array.from({length:d},(c,m)=>n.intercept+n.slope*(i.length+m))];g=new w(T.value,{type:"line",data:{labels:p,datasets:[{label:"Actual Lap Times",data:[...s,...Array(d).fill(null)],borderColor:u(0),backgroundColor:u(0)+"20",tension:.4,pointRadius:4},{label:"Performance Trend",data:l,borderColor:u(1),backgroundColor:u(1)+"20",borderDash:[5,5],tension:.4,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!1,ticks:{callback:c=>_(Number(c))}}}}})}if(M.value){const t=q(o),i=Object.keys(t);b=new w(M.value,{type:"bar",data:{labels:i,datasets:[{label:"Win Probability",data:i.map(a=>{var s;return((s=t[a])==null?void 0:s.winProb)||0}),backgroundColor:u(0)},{label:"Podium Probability",data:i.map(a=>{var s;return((s=t[a])==null?void 0:s.podiumProb)||0}),backgroundColor:u(1)},{label:"Top 5 Probability",data:i.map(a=>{var s;return((s=t[a])==null?void 0:s.top5Prob)||0}),backgroundColor:u(2)}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0,max:100,ticks:{callback:a=>a+"%"}}}}})}if(x.value){const t=["Sunny","Cloudy","Rainy","Windy"],i=Math.min(...o.map(s=>s.lap_time)),a=t.map(s=>{let n=0;switch(s){case"Sunny":n=0;break;case"Cloudy":n=.002;break;case"Rainy":n=.015;break;case"Windy":n=.005;break}return i+(Math.random()-.5)*.01+n});y=new w(x.value,{type:"scatter",data:{datasets:[{label:"Lap Time by Condition",data:t.map((s,n)=>({x:n,y:a[n]||0})),backgroundColor:u(0),pointRadius:8}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{ticks:{callback:s=>t[Number(s)]||""}},y:{ticks:{callback:s=>_(Number(s))}}}}})}}},q=o=>{const t={},i=o.reduce((a,s)=>{const n=s.track_name||"Unknown";return a[n]||(a[n]=[]),a[n].push(s),a},{});return Object.entries(i).forEach(([a,s])=>{const n=s;if(n.length>=5){const r=Math.min(...n.map(c=>c.lap_time)),d=n.reduce((c,m)=>c+m.lap_time,0)/n.length,p=(d-r)/d,l=Math.max(.1,Math.min(.9,1-p));t[a]={winProb:Math.round(l*30),podiumProb:Math.round(l*60),top5Prob:Math.round(l*85)}}}),t},_=o=>{if(!o||o===0)return"0.000";const t=Math.floor(o/60),i=(o%60).toFixed(3);return t>0?`${t}:${i.padStart(6,"0")}`:i};return at(async()=>{await H()}),nt(()=>{g&&g.destroy(),b&&b.destroy(),y&&y.destroy()}),(o,t)=>(P(),C("div",dt,[t[18]||(t[18]=e("div",{class:"page-header"},[e("h1",null,"ğŸ”® Predictive Analytics"),e("p",{class:"subtitle"},"AI-powered insights and performance predictions")],-1)),e("div",lt,[e("div",pt,[t[0]||(t[0]=e("div",{class:"prediction-icon"},"ğŸ¯",-1)),t[1]||(t[1]=e("div",{class:"prediction-title"},"Next Best Lap Prediction",-1)),e("div",mt,v(_(h.value.nextBestLap)),1),e("div",vt,[e("span",{class:"confidence-bar",style:$({width:h.value.confidence+"%"})},null,4),e("span",ut,v(h.value.confidence)+"% confidence",1)]),t[2]||(t[2]=e("div",{class:"prediction-detail"},"Based on your improvement trend",-1))]),e("div",ht,[t[3]||(t[3]=e("div",{class:"prediction-icon"},"ğŸ“…",-1)),t[4]||(t[4]=e("div",{class:"prediction-title"},"Optimal Training Day",-1)),e("div",ft,v(h.value.bestDay),1),e("div",gt,v(h.value.bestDayReason),1)]),e("div",bt,[t[5]||(t[5]=e("div",{class:"prediction-icon"},"ğŸ†",-1)),t[6]||(t[6]=e("div",{class:"prediction-title"},"Podium Probability",-1)),e("div",yt,v(h.value.podiumChance)+"%",1),t[7]||(t[7]=e("div",{class:"prediction-detail"},"In next competitive race",-1))]),e("div",_t,[t[8]||(t[8]=e("div",{class:"prediction-icon"},"âš¡",-1)),t[9]||(t[9]=e("div",{class:"prediction-title"},"Improvement Potential",-1)),e("div",kt,v(h.value.improvementPotential)+"s",1),t[10]||(t[10]=e("div",{class:"prediction-detail"},"Achievable in next month",-1))])]),t[19]||(t[19]=ot('<div class="insights-section" data-v-709f8029><h3 data-v-709f8029>ğŸ¤– Machine Learning Insights</h3><div class="insights-grid" data-v-709f8029><div class="insight-card" data-v-709f8029><div class="insight-header" data-v-709f8029><span class="insight-icon" data-v-709f8029>ğŸ“ˆ</span><span class="insight-title" data-v-709f8029>Performance Trend</span></div><div class="insight-content" data-v-709f8029><p data-v-709f8029>You&#39;re improving at an average rate of <strong data-v-709f8029>0.15 seconds per week</strong>. This is excellent progress!</p><div class="insight-chart" data-v-709f8029><div class="trend-line up" data-v-709f8029></div></div></div></div><div class="insight-card" data-v-709f8029><div class="insight-header" data-v-709f8029><span class="insight-icon" data-v-709f8029>ğŸ¯</span><span class="insight-title" data-v-709f8029>Optimal Track</span></div><div class="insight-content" data-v-709f8029><p data-v-709f8029>You perform best at <strong data-v-709f8029>Circuit Park Berghem</strong> with 15% better consistency than other tracks.</p><div class="track-recommendation" data-v-709f8029><span class="track-emoji" data-v-709f8029>ğŸ</span><span data-v-709f8029>Circuit Park Berghem</span></div></div></div><div class="insight-card" data-v-709f8029><div class="insight-header" data-v-709f8029><span class="insight-icon" data-v-709f8029>â°</span><span class="insight-title" data-v-709f8029>Peak Performance Time</span></div><div class="insight-content" data-v-709f8029><p data-v-709f8029>Your fastest laps are typically set between <strong data-v-709f8029>2 PM - 4 PM</strong>. Schedule important sessions accordingly.</p><div class="time-indicator" data-v-709f8029><span data-v-709f8029>ğŸŒ Afternoon</span></div></div></div><div class="insight-card" data-v-709f8029><div class="insight-header" data-v-709f8029><span class="insight-icon" data-v-709f8029>ğŸ’¡</span><span class="insight-title" data-v-709f8029>Smart Recommendation</span></div><div class="insight-content" data-v-709f8029><p data-v-709f8029>Focus on <strong data-v-709f8029>corner entry speed</strong> - analysis shows this is your biggest improvement opportunity.</p><div class="recommendation-badge" data-v-709f8029><span data-v-709f8029>Priority: High</span></div></div></div></div></div>',1)),e("div",Pt,[e("div",Ct,[t[11]||(t[11]=e("h3",null,"ğŸ“Š Performance Forecast",-1)),e("canvas",{ref_key:"performanceChart",ref:T},null,512)]),e("div",wt,[t[12]||(t[12]=e("h3",null,"ğŸ² Race Outcome Probabilities",-1)),e("canvas",{ref_key:"probabilityChart",ref:M},null,512)]),e("div",Tt,[t[13]||(t[13]=e("h3",null,"ğŸŒ¡ï¸ Condition Impact Analysis",-1)),e("canvas",{ref_key:"conditionChart",ref:x},null,512)])]),e("div",Mt,[t[15]||(t[15]=e("h3",null,"ğŸ¯ Goal Achievement Timeline",-1)),e("div",xt,[(P(!0),C(E,null,O(I.value,i=>(P(),C("div",{key:i.id,class:"goal-timeline-item"},[e("div",Dt,[e("div",{class:L(["goal-circle",i.status])},null,2),t[14]||(t[14]=e("div",{class:"goal-line"},null,-1))]),e("div",At,[e("div",Lt,[e("h4",null,v(i.title),1),e("span",St,v(i.predictedDate),1)]),e("p",Bt,v(i.description),1),e("div",It,[e("div",Rt,[e("div",{class:"probability-fill",style:$({width:i.probability+"%"})},null,4)]),e("span",Ft,v(i.probability)+"% likely",1)])])]))),128))])]),e("div",$t,[t[17]||(t[17]=e("h3",null,"ğŸ’¡ AI-Powered Recommendations",-1)),e("div",Et,[(P(!0),C(E,null,O(R.value,(i,a)=>(P(),C("div",{key:a,class:"recommendation-item"},[e("div",{class:L(["rec-icon",i.priority])},v(i.icon),3),e("div",Ot,[e("div",zt,v(i.title),1),e("div",jt,v(i.description),1),e("div",Ht,[t[16]||(t[16]=e("span",{class:"impact-label"},"Expected Impact:",-1)),e("span",Nt,v(i.impact),1)])]),e("div",Ut,[e("span",{class:L(["priority-badge",i.priority])},v(i.priority),3)])]))),128))])])]))}}),Jt=ct(Wt,[["__scopeId","data-v-709f8029"]]);export{Jt as default};
