import{C as b,r as nt}from"./chart-DaPPa1q0.js";import{u as ot}from"./useChartConfig-CCFcitaf.js";import{u as it}from"./useKartingAPI-uF34JNNR.js";import{d as rt,k as lt,C as ct,o as T,c as C,e as n,F as x,n as W,s as dt,t as l,f as w,r as u,G as ut}from"./index-BIUjLROW.js";import{_ as mt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./driverColors-pQD1MuRz.js";const vt={class:"temporal-view"},ht={class:"period-selector"},ft=["onClick"],pt={class:"period-icon"},gt={class:"stats-grid"},_t={class:"stat-card"},yt={class:"stat-content"},bt={class:"stat-value"},wt={class:"stat-label"},Dt={class:"stat-trend positive"},kt={class:"stat-card"},St={class:"stat-content"},Tt={class:"stat-value"},Ct={class:"stat-card"},Mt={class:"stat-content"},At={class:"stat-value"},Et={class:"stat-card"},Lt={class:"stat-content"},Pt={class:"stat-value"},It={class:"stat-trend"},$t={class:"charts-grid"},Bt={class:"chart-card large"},Ot={class:"chart-container"},Ft={class:"chart-card"},Ht={class:"chart-container"},xt={class:"chart-card"},Wt={class:"chart-container"},Nt={class:"chart-card"},zt={class:"chart-container"},Rt={class:"chart-card full-width"},jt={class:"chart-container"},Gt={class:"timeline-card"},Vt={class:"timeline"},Ut={class:"timeline-content"},Yt={class:"timeline-date"},Kt={class:"timeline-title"},Zt={class:"timeline-description"},qt=rt({__name:"TemporalView",setup(Qt){b.register(...nt);const{getColor:d}=ot(),{getAllLaps:N,loading:$,error:B}=it(),v=u("month"),z=[{value:"week",label:"Week",icon:"ðŸ“…"},{value:"month",label:"Month",icon:"ðŸ“†"},{value:"quarter",label:"Quarter",icon:"ðŸ“Š"},{value:"year",label:"Year",icon:"ðŸ—“ï¸"}],m=u({sessionsThisPeriod:0,sessionGrowth:0,avgImprovement:0,streakDays:0,bestMonth:"-",bestMonthSessions:0}),O=u([]),M=u(),D=u(),A=u(),E=u(),L=u();let p=null,g=null,_=null,y=null;const F=async()=>{try{$.value=!0,B.value="";const i=await N();if(!i)throw new Error("Failed to load lap data for temporal analysis");R(i),U(i),await ut(),q(i)}catch(i){console.error("Error loading temporal data:",i),B.value=i.message||"Failed to load temporal data"}finally{$.value=!1}},R=i=>{if(i.length===0)return;const s=P(new Date,v.value),o=i.filter(c=>new Date(c.created_at)>=s),e=new Set(o.map(c=>c.session_id)).size,a=P(new Date(s.getTime()-1),v.value),r=new Date(s.getTime()-1),k=i.filter(c=>{const S=new Date(c.created_at);return S>=a&&S<=r}),f=new Set(k.map(c=>c.session_id)).size,I=f>0?Math.round((e-f)/f*100):0,et=i.sort((c,S)=>new Date(c.created_at).getTime()-new Date(S.created_at).getTime()).slice(-50),st=j(et),at=G(i),H=V(i);m.value={sessionsThisPeriod:e,sessionGrowth:I,avgImprovement:st,streakDays:at,bestMonth:H.month,bestMonthSessions:H.sessions}},P=(i,t)=>{const s=new Date(i);switch(t){case"week":s.setDate(s.getDate()-7);break;case"month":s.setMonth(s.getMonth()-1);break;case"quarter":s.setMonth(s.getMonth()-3);break;case"year":s.setFullYear(s.getFullYear()-1);break}return s},j=i=>{if(i.length<10)return 0;const t=i.slice(0,Math.floor(i.length/2)),s=i.slice(Math.floor(i.length/2)),o=t.reduce((a,r)=>a+r.lap_time,0)/t.length,e=s.reduce((a,r)=>a+r.lap_time,0)/s.length;return Math.max(0,o-e)},G=i=>{const t=[...new Set(i.map(e=>new Date(e.created_at).toDateString()))].map(e=>new Date(e)).filter(e=>!isNaN(e.getTime())).sort((e,a)=>a.getTime()-e.getTime());let s=0;const o=new Date;o.setHours(0,0,0,0);for(let e=0;e<t.length;e++){const a=t[e];if(!a)continue;a.setHours(0,0,0,0);const r=new Date(o.getTime()-e*24*60*60*1e3);if(a.getTime()===r.getTime())s++;else break}return s},V=i=>{const t={};i.forEach(e=>{const a=new Date(e.created_at),r=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;t[r]||(t[r]=0),t[r]++});let s="",o=0;return Object.entries(t).forEach(([e,a])=>{a>o&&(o=a,s=e)}),{month:s,sessions:o}},U=i=>{const t=[];if(i.length===0)return;const s=i.sort((a,r)=>new Date(a.created_at).getTime()-new Date(r.created_at).getTime());Y(s).forEach(a=>{t.push({date:new Date(a.date).toLocaleDateString(),title:`New Personal Best: ${h(a.time)}`,description:`Achieved at ${a.track} - ${a.improvement.toFixed(3)}s improvement`})}),K(s).forEach(a=>{t.push({date:a.date,title:a.title,description:a.description})}),O.value=t.sort((a,r)=>new Date(r.date).getTime()-new Date(a.date).getTime()).slice(0,10)},Y=i=>{const t=[];let s=1/0;return i.forEach(o=>{if(o.lap_time<s){const e=s-o.lap_time;s!==1/0&&t.push({date:o.created_at,time:o.lap_time,track:o.track_name||"Unknown",improvement:e}),s=o.lap_time}}),t.slice(0,5)},K=i=>{const t=[],s=Z(i);return Object.entries(s).forEach(([o,e])=>{if(!e||!Array.isArray(e))return;const a=e.length,r=e[0];a>=20&&r&&t.push({date:new Date(r.created_at).toLocaleDateString(),title:`High Volume Session: ${a} laps`,description:`Completed ${a} laps in one session at ${r.track_name||"Unknown"}`})}),t},Z=i=>i.reduce((t,s)=>{const o=s.session_id;return t[o]||(t[o]=[]),t[o].push(s),t},{}),q=i=>{if(i.length!==0){if(p&&p.destroy(),g&&g.destroy(),_&&_.destroy(),y&&y.destroy(),M.value){const t=P(new Date,v.value),s=i.filter(a=>new Date(a.created_at)>=t).sort((a,r)=>new Date(a.created_at).getTime()-new Date(r.created_at).getTime()),o=s.map((a,r)=>`Lap ${r+1}`),e=s.map(a=>a.lap_time);p=new b(M.value,{type:"line",data:{labels:o,datasets:[{label:"Lap Time",data:e,borderColor:d(0),backgroundColor:d(0)+"20",tension:.4,pointRadius:3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!1,ticks:{callback:a=>h(Number(a))}}}}})}if(A.value){const t=Q(i),s=Array.from({length:24},(e,a)=>a),o=s.map(e=>t[e]||null);g=new b(A.value,{type:"radar",data:{labels:s.map(e=>`${e}:00`),datasets:[{label:"Average Lap Time",data:o,borderColor:d(0),backgroundColor:d(0)+"20",pointRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{r:{ticks:{callback:e=>h(Number(e))}}}}})}if(E.value){const t=J(i),s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];_=new b(E.value,{type:"bar",data:{labels:s,datasets:[{label:"Average Lap Time",data:s.map(o=>{var e;return((e=t[o])==null?void 0:e.avg)||null}),backgroundColor:d(0),borderColor:d(0),borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!1,ticks:{callback:o=>h(Number(o))}}}}})}if(L.value){const t=X(i),s=["Winter","Spring","Summer","Fall"];y=new b(L.value,{type:"line",data:{labels:s,datasets:[{label:"Average Lap Time",data:s.map(o=>{var e;return((e=t[o])==null?void 0:e.avg)||null}),borderColor:d(0),backgroundColor:d(0)+"20",tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!1,ticks:{callback:o=>h(Number(o))}}}}})}D.value&&tt(i)}},Q=i=>{const t={};i.forEach(o=>{const e=new Date(o.created_at).getHours();t[e]||(t[e]={times:[],count:0}),t[e].times.push(o.lap_time),t[e].count++});const s={};return Object.entries(t).forEach(([o,e])=>{e.times.length>=3&&(s[parseInt(o)]=e.times.reduce((a,r)=>a+r,0)/e.times.length)}),s},J=i=>{const t={};i.forEach(o=>{const e=new Date(o.created_at).toLocaleDateString("en-US",{weekday:"long"});t[e]||(t[e]={times:[],count:0}),t[e].times.push(o.lap_time),t[e].count++});const s={};return Object.entries(t).forEach(([o,e])=>{e.times.length>=3&&(s[o]={avg:e.times.reduce((a,r)=>a+r,0)/e.times.length,count:e.count})}),s},X=i=>{const t={};i.forEach(o=>{const e=new Date(o.created_at).getMonth();let a="";e>=11||e<=1?a="Winter":e>=2&&e<=4?a="Spring":e>=5&&e<=7?a="Summer":a="Fall",t[a]||(t[a]={times:[],count:0}),t[a].times.push(o.lap_time),t[a].count++});const s={};return Object.entries(t).forEach(([o,e])=>{e.times.length>=5&&(s[o]={avg:e.times.reduce((a,r)=>a+r,0)/e.times.length,count:e.count})}),s},tt=i=>{if(!D.value)return;const t={};i.forEach(e=>{const a=new Date(e.created_at).toDateString();t[a]=(t[a]||0)+1});const s=new Date;let o='<div class="heatmap-grid">';for(let e=4;e>=0;e--){o+='<div class="heatmap-week">';for(let a=0;a<7;a++){const r=new Date(s);r.setDate(r.getDate()-(e*7+(6-a)));const k=r.toDateString(),f=t[k]||0,I=Math.min(f/5,1);o+=`<div class="heatmap-day" style="background-color: rgba(102, 126, 234, ${I*.8})" title="${k}: ${f} sessions"></div>`}o+="</div>"}o+="</div>",D.value.innerHTML=o},h=i=>{const t=Math.floor(i/60),s=(i%60).toFixed(3);return`${t}:${s.padStart(6,"0")}`};return lt(async()=>{await F()}),ct(()=>{p&&p.destroy(),g&&g.destroy(),_&&_.destroy(),y&&y.destroy()}),(i,t)=>(T(),C("div",vt,[t[18]||(t[18]=n("div",{class:"page-header"},[n("h1",null,"â° Temporal Analysis"),n("p",{class:"subtitle"},"Performance trends over time and seasonal patterns")],-1)),n("div",ht,[(T(),C(x,null,W(z,s=>n("button",{key:s.value,class:dt(["period-btn",{active:v.value===s.value}]),onClick:o=>{v.value=s.value,F()}},[n("span",pt,l(s.icon),1),w(" "+l(s.label),1)],10,ft)),64))]),n("div",gt,[n("div",_t,[t[1]||(t[1]=n("div",{class:"stat-icon"},"ðŸ“…",-1)),n("div",yt,[n("div",bt,l(m.value.sessionsThisPeriod),1),n("div",wt,"Sessions This "+l(v.value),1)]),n("div",Dt,[t[0]||(t[0]=n("span",null,"â†—",-1)),w(" "+l(m.value.sessionGrowth)+"% ",1)])]),n("div",kt,[t[3]||(t[3]=n("div",{class:"stat-icon"},"âš¡",-1)),n("div",St,[n("div",Tt,l(h(m.value.avgImprovement)),1),t[2]||(t[2]=n("div",{class:"stat-label"},"Avg Time Improvement",-1))]),t[4]||(t[4]=n("div",{class:"stat-trend positive"},[n("span",null,"â†—"),w(" Getting faster! ")],-1))]),n("div",Ct,[t[6]||(t[6]=n("div",{class:"stat-icon"},"ðŸ”¥",-1)),n("div",Mt,[n("div",At,l(m.value.streakDays),1),t[5]||(t[5]=n("div",{class:"stat-label"},"Day Streak",-1))]),t[7]||(t[7]=n("div",{class:"stat-trend"},[n("span",null,"ðŸ“Š"),w(" Keep it up! ")],-1))]),n("div",Et,[t[10]||(t[10]=n("div",{class:"stat-icon"},"ðŸ†",-1)),n("div",Lt,[n("div",Pt,l(m.value.bestMonth),1),t[8]||(t[8]=n("div",{class:"stat-label"},"Best Month",-1))]),n("div",It,[t[9]||(t[9]=n("span",null,"â­",-1)),w(" "+l(m.value.bestMonthSessions)+" sessions ",1)])])]),n("div",$t,[n("div",Bt,[t[11]||(t[11]=n("h3",null,"ðŸ“ˆ Performance Over Time",-1)),n("div",Ot,[n("canvas",{ref_key:"performanceChart",ref:M},null,512)])]),n("div",Ft,[t[12]||(t[12]=n("h3",null,"ðŸ“… Activity Heatmap",-1)),n("div",Ht,[n("div",{ref_key:"activityHeatmap",ref:D,class:"heatmap-container"},null,512)])]),n("div",xt,[t[13]||(t[13]=n("h3",null,"ðŸ• Time of Day Performance",-1)),n("div",Wt,[n("canvas",{ref_key:"timeOfDayChart",ref:A},null,512)])]),n("div",Nt,[t[14]||(t[14]=n("h3",null,"ðŸ“† Day of Week Analysis",-1)),n("div",zt,[n("canvas",{ref_key:"dayOfWeekChart",ref:E},null,512)])]),n("div",Rt,[t[15]||(t[15]=n("h3",null,"ðŸŒ¡ï¸ Seasonal Trends",-1)),n("div",jt,[n("canvas",{ref_key:"seasonalChart",ref:L},null,512)])])]),n("div",Gt,[t[17]||(t[17]=n("h3",null,"ðŸŽ¯ Performance Milestones",-1)),n("div",Vt,[(T(!0),C(x,null,W(O.value,(s,o)=>(T(),C("div",{key:o,class:"timeline-item"},[t[16]||(t[16]=n("div",{class:"timeline-dot"},null,-1)),n("div",Ut,[n("div",Yt,l(s.date),1),n("div",Kt,l(s.title),1),n("div",Zt,l(s.description),1)])]))),128))])])]))}}),oe=mt(qt,[["__scopeId","data-v-5da876b7"]]);export{oe as default};
