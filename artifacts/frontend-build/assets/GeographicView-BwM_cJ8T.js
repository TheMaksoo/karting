import{d as F,a as G,k as M,C as $,o,c as n,e as s,g as I,J as x,F as k,n as h,t as r,h as y,p as E,i as w,f as P,y as i,r as _,G as J}from"./index-BIUjLROW.js";import{L,T as K}from"./TrackMap-BJcx-QW4.js";import{u as O}from"./useKartingAPI-uF34JNNR.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"geographic-view"},Q={class:"filters"},W={class:"filter-group"},X=["value"],Y={class:"filter-group"},Z=["value"],ee={class:"stats-summary"},se={class:"stat-item"},te={class:"stat-value"},ae={class:"stat-item"},oe={class:"stat-value"},ne={class:"stat-item"},re={class:"stat-value"},le={key:0,class:"loading-state"},ie={key:1,class:"error-state"},ue={key:2,class:"map-section"},de={class:"map-container"},ce={key:3,class:"track-list"},ve={class:"track-grid"},pe={class:"track-info"},fe={class:"track-location"},me={key:0},_e={key:1},ge={class:"track-stats"},ke={class:"stat"},he={class:"value"},ye={class:"stat"},we={class:"value"},be={key:0,class:"stat"},De={class:"value"},Te={key:4,class:"empty-state"},Ce=F({__name:"GeographicView",setup(Se){delete L.Icon.Default.prototype._getIconUrl,L.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const l=G(),b=i(()=>{var a;return(a=l.user)==null?void 0:a.driver_id}),g=_(null),{getTrackStats:N,getDriverStats:R,loading:c,error:u}=O(),v=_([]),p=_(""),f=_(""),U=i(()=>[...new Set(v.value.map(e=>e.region).filter(Boolean))].sort()),V=i(()=>[...new Set(v.value.map(e=>e.country).filter(Boolean))].sort()),d=i(()=>{let a=v.value;return p.value&&(a=a.filter(e=>e.region===p.value)),f.value&&(a=a.filter(e=>e.country===f.value)),a.filter(e=>e.latitude&&e.longitude)}),A=i(()=>d.value.reduce((a,e)=>a+e.total_sessions,0)),j=i(()=>d.value.reduce((a,e)=>a+e.total_laps,0));async function D(){var a;try{l.user||await l.fetchCurrentUser();let e=b.value;if(!e||e===void 0){if((a=l.user)!=null&&a.name)try{const m=await R();if(m){const C=m.find(q=>{var S;return q.driver_name.toLowerCase()===((S=l.user)==null?void 0:S.name.toLowerCase())});if(C)e=C.driver_id,g.value=e;else{console.error("No driver found matching user name:",l.user.name),u.value=`No driver profile found for "${l.user.name}". Please contact an administrator.`,c.value=!1;return}}}catch(m){console.error("Error finding driver by name:",m)}if(!e){console.error("Driver ID not found. Auth user:",l.user),u.value="Driver ID not found. Please contact an administrator to link your account to a driver profile.",c.value=!1;return}}g.value=e;const t=await N();v.value=t||[],await J()}catch(e){console.error("Error loading track data:",e),u.value="Failed to load track data"}finally{c.value=!1}}function T(){}function B(a){if(!a)return"N/A";const e=Math.floor(a/60),t=(a%60).toFixed(3);return e>0?`${e}:${t.padStart(6,"0")}`:`${t}s`}return M(async()=>{await D()}),$(()=>{}),(a,e)=>(o(),n("div",H,[e[15]||(e[15]=s("header",{class:"page-header"},[s("h1",null,"üó∫Ô∏è Geographic Analysis"),s("p",null,"Track locations and regional performance insights")],-1)),s("div",Q,[s("div",W,[e[3]||(e[3]=s("label",null,"Region:",-1)),I(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),onChange:T},[e[2]||(e[2]=s("option",{value:""},"All Regions",-1)),(o(!0),n(k,null,h(U.value,t=>(o(),n("option",{key:t,value:t},r(t),9,X))),128))],544),[[x,p.value]])]),s("div",Y,[e[5]||(e[5]=s("label",null,"Country:",-1)),I(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),onChange:T},[e[4]||(e[4]=s("option",{value:""},"All Countries",-1)),(o(!0),n(k,null,h(V.value,t=>(o(),n("option",{key:t,value:t},r(t),9,Z))),128))],544),[[x,f.value]])]),s("div",ee,[s("div",se,[e[6]||(e[6]=s("span",{class:"stat-label"},"Tracks Shown",-1)),s("span",te,r(d.value.length),1)]),s("div",ae,[e[7]||(e[7]=s("span",{class:"stat-label"},"Total Sessions",-1)),s("span",oe,r(A.value),1)]),s("div",ne,[e[8]||(e[8]=s("span",{class:"stat-label"},"Total Laps",-1)),s("span",re,r(j.value),1)])])]),y(c)?(o(),n("div",le,[...e[9]||(e[9]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading track locations...",-1)])])):y(u)?(o(),n("div",ie,[s("p",null,"‚ùå "+r(y(u)),1),s("button",{onClick:D,class:"retry-btn"},"Retry")])):(o(),n("div",ue,[s("div",de,[E(K,{"driver-id":g.value||b.value},null,8,["driver-id"])])])),d.value.length>0?(o(),n("div",ce,[e[13]||(e[13]=s("h3",null,"üìç Track Details",-1)),s("div",ve,[(o(!0),n(k,null,h(d.value,t=>(o(),n("div",{key:t.track_id,class:"track-card"},[s("div",pe,[s("h4",null,r(t.track_name),1),s("p",fe,[t.city?(o(),n("span",me,r(t.city)+", ",1)):w("",!0),P(r(t.country)+" ",1),t.region?(o(),n("span",_e," ‚Ä¢ "+r(t.region),1)):w("",!0)])]),s("div",ge,[s("div",ke,[e[10]||(e[10]=s("span",{class:"label"},"Sessions:",-1)),s("span",he,r(t.total_sessions),1)]),s("div",ye,[e[11]||(e[11]=s("span",{class:"label"},"Laps:",-1)),s("span",we,r(t.total_laps),1)]),t.track_record?(o(),n("div",be,[e[12]||(e[12]=s("span",{class:"label"},"Record:",-1)),s("span",De,r(B(t.track_record)),1)])):w("",!0)])]))),128))])])):(o(),n("div",Te,[...e[14]||(e[14]=[s("p",null,"üó∫Ô∏è No tracks found in the selected region",-1),s("p",{class:"hint"},"Try selecting a different region or country filter",-1)])]))]))}}),Re=z(Ce,[["__scopeId","data-v-d421b69f"]]);export{Re as default};
